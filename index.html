<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #ebebed; -webkit-text-stroke: #ebebed; background-color: #161618}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #ebebed; -webkit-text-stroke: #ebebed; background-color: #161618; min-height: 15.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en" class="h-full"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta charset="UTF-8" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;title&gt;Crypto Portfolio Dashboard&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>:root { color-scheme: dark; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Inter", sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>::-webkit-scrollbar { width: 8px; height: 8px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>::-webkit-scrollbar-thumb { background: rgba(148,163,184,.6); border-radius: 999px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>::-webkit-scrollbar-track { background: transparent; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas { display: block; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body class="min-h-screen bg-slate-950 text-slate-100 antialiased"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="min-h-screen flex flex-col"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- HEADER --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;header class="border-b border-slate-900 bg-slate-950/80 backdrop-blur"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="flex items-center gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="relative flex h-9 w-9 items-center justify-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div class="absolute inset-0 rounded-2xl bg-gradient-to-tr from-emerald-500/30 via-cyan-400/10 to-sky-500/40 blur-md opacity-70"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div class="relative flex h-8 w-8 items-center justify-center rounded-2xl border border-emerald-400/60 bg-slate-950/80"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;span class="h-2.5 w-2.5 rounded-full bg-emerald-400 shadow-[0_0_12px_rgba(16,185,129,0.9)]"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;h1 class="text-base sm:text-lg font-semibold tracking-tight flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>Minimal Crypto</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;span class="rounded-full border border-emerald-500/40 bg-emerald-500/10 px-2 py-0.5 text-[10px] font-medium uppercase tracking-[0.18em] text-emerald-300"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>Portfolio</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;p class="mt-1 text-xs text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>Clean crypto dashboard with live pricing, TA tools, alerts, risk &amp; news.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="flex items-center gap-3 text-[11px] sm:text-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="hidden sm:flex items-center gap-2 text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span class="inline-flex h-2 w-2 rounded-full bg-emerald-400 animate-pulse"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span id="price-status"&gt;Live prices&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="hidden sm:flex flex-col items-end text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span class="uppercase tracking-[0.16em] text-[9px]"&gt;Updated&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span id="last-updated" class="font-mono text-xs text-slate-300"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;select id="global-currency-select"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>class="rounded-full border border-slate-700 bg-slate-900/90 px-2 py-1.5 text-[11px] font-medium text-slate-200 focus:outline-none focus:border-emerald-500/70"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;option value="usd" selected&gt;USD&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;option value="eur"&gt;EUR&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;option value="gbp"&gt;GBP&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;option value="jpy"&gt;JPY&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;option value="aud"&gt;AUD&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;option value="cad"&gt;CAD&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button id="refresh-btn"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>class="inline-flex items-center gap-1.5 rounded-full border border-slate-700 bg-slate-900/90 px-3 py-1.5 text-[11px] font-medium hover:border-emerald-400/70 hover:text-emerald-200 transition"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span id="refresh-dot" class="h-1.5 w-1.5 rounded-full bg-emerald-400"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>Refresh</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/header&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- MARKET SENTIMENT STRIP --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;div class="border-b border-slate-900 bg-slate-950/50 backdrop-blur px-4 py-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="max-w-6xl mx-auto flex flex-wrap items-center justify-between gap-4 text-[10px] sm:text-[11px]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="flex items-center gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span class="uppercase tracking-widest text-slate-500"&gt;Fear &amp; Greed&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div class="flex items-center gap-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="fng-value" class="font-bold text-slate-200"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="fng-label" class="text-slate-400"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="h-1.5 w-12 rounded-full bg-slate-800 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">               </span>&lt;div id="fng-bar" class="h-full w-0 bg-slate-500 transition-all duration-500"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span class="uppercase tracking-widest text-slate-500"&gt;BTC Dom&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span id="btc-dom" class="font-mono text-slate-200"&gt;--%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span class="uppercase tracking-widest text-slate-500"&gt;Altseason&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span id="alt-season" class="font-mono text-slate-200"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="hidden sm:flex items-center gap-4 text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div&gt;Global Cap: &lt;span id="global-mcap" class="text-slate-300"&gt;--&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div&gt;Alt Cap &lt;span class="text-[9px] opacity-70"&gt;(ex BTC/ETH)&lt;/span&gt;: &lt;span id="alt-mcap" class="text-slate-300"&gt;--&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- Toasts --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2 max-w-xs"&gt;&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- MAIN --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;main class="flex-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6 sm:space-y-8"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;!-- SUMMARY STRIP --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;section&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="grid gap-4 sm:gap-5 md:grid-cols-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- Total --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div class="md:col-span-2 rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-5 sm:py-5 shadow-sm shadow-emerald-500/10"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-start justify-between gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;Total balance&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p id="total-value" class="mt-2 text-2xl sm:text-3xl font-semibold tracking-tight"&gt;$0.00&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-[11px] sm:text-xs text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center gap-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="inline-block h-1.5 w-1.5 rounded-full bg-emerald-400"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span&gt;Cost basis&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span id="total-cost" class="font-mono text-slate-100"&gt;$0.00&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center gap-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="inline-block h-1.5 w-1.5 rounded-full bg-cyan-400"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span&gt;Unrealized P/L&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span id="total-pnl" class="font-mono text-slate-100"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span id="total-pnl-pct" class="font-mono text-[11px] text-slate-400"&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="hidden sm:flex flex-col items-end gap-2 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="inline-flex items-center gap-2 rounded-full border border-slate-700 bg-slate-950/80 px-3 py-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;span class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Assets&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;span id="assets-count" class="font-mono text-xs text-slate-100"&gt;0&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p id="allocation-note" class="max-w-[12rem] text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Keep majors heavy for smoother drawdowns.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- 24h P/L --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-4.5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;24h P/L&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="day-pnl" class="mt-2 text-xl font-semibold"&gt;$0.00&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="day-pnl-pct" class="mt-1 text-[11px] font-mono text-slate-400"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="mt-2 text-[11px] text-slate-500"&gt;Approx from per-asset 24h moves.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- Best --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-4.5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;Best 24h&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="best-asset-name" class="mt-2 text-sm font-medium"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="best-asset-change" class="mt-1 text-[11px] font-mono text-slate-400"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="mt-2 text-[11px] text-slate-500"&gt;Ignores tiny positions.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- Worst --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-4.5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;Worst 24h&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="worst-asset-name" class="mt-2 text-sm font-medium"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="worst-asset-change" class="mt-1 text-[11px] font-mono text-slate-400"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="mt-2 text-[11px] text-slate-500"&gt;Helps find what to trim.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;!-- MAIN GRID --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;section class="grid gap-6 lg:grid-cols-[minmax(0,2.1fr)_minmax(0,1.2fr)] items-start"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- LEFT COLUMN --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="space-y-6"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- PRICE CHART + TA --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 pt-4 pb-3 sm:px-5 sm:pt-5 sm:pb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-wrap items-center justify-between gap-3 mb-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;Portfolio curve &amp; TA&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Synthetic equity curve (USD base) with indicators, drawing tools &amp; chart types.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="flex flex-col items-end gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="inline-flex rounded-full border border-slate-700 bg-slate-950/80 p-0.5 text-[11px]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="button" data-timeframe="24h"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="timeframe-btn rounded-full px-2.5 py-1 bg-slate-800 text-slate-100 shadow-[0_0_0_1px_rgba(148,163,184,0.55)]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>24H</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="button" data-timeframe="7d"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="timeframe-btn rounded-full px-2.5 py-1 text-slate-400 hover:text-slate-100"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>7D</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="button" data-timeframe="30d"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="timeframe-btn rounded-full px-2.5 py-1 text-slate-400 hover:text-slate-100"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>30D</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- TA Controls --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mb-3 flex flex-wrap items-center justify-between gap-3 text-[10px] sm:text-[11px]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="flex flex-wrap items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span class="uppercase tracking-[0.18em] text-slate-500"&gt;Chart&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="inline-flex rounded-full border border-slate-700 bg-slate-950/80 p-0.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="button" data-chart-type="line"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="chart-type-btn rounded-full px-2.5 py-1 bg-slate-800 text-slate-100 shadow-[0_0_0_1px_rgba(148,163,184,0.55)]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Line</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="button" data-chart-type="candles"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="chart-type-btn rounded-full px-2.5 py-1 text-slate-400 hover:text-slate-100"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Candles</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="button" data-chart-type="bars"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="chart-type-btn rounded-full px-2.5 py-1 text-slate-400 hover:text-slate-100"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Bars</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="flex flex-wrap items-center gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex flex-wrap items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;span class="uppercase tracking-[0.18em] text-slate-500"&gt;Indicators&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;label class="inline-flex items-center gap-1 text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input id="indicator-bb" type="checkbox"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="h-3 w-3 rounded border-slate-600 bg-slate-950 text-emerald-500 focus:ring-emerald-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span&gt;BB&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;label class="inline-flex items-center gap-1 text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input id="indicator-rsi" type="checkbox"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="h-3 w-3 rounded border-slate-600 bg-slate-950 text-emerald-500 focus:ring-emerald-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span&gt;RSI&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;label class="inline-flex items-center gap-1 text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input id="indicator-macd" type="checkbox"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="h-3 w-3 rounded border-slate-600 bg-slate-950 text-emerald-500 focus:ring-emerald-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span&gt;MACD&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex flex-wrap items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;span class="uppercase tracking-[0.18em] text-slate-500"&gt;Draw&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;select id="draw-tool-select"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="rounded-full border border-slate-700 bg-slate-950/80 px-2.5 py-1 text-[11px] text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="none"&gt;None&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="trendline"&gt;Trendline&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="fib"&gt;Fib retracement&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="button" id="draw-clear"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="rounded-full border border-slate-700 bg-slate-950/80 px-2.5 py-1 text-[11px] text-slate-300 hover:border-slate-500 hover:text-slate-100"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Clear</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="relative h-64 sm:h-72"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;canvas id="performance-chart" class="absolute inset-0 w-full h-full"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div id="chart-empty"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                   </span>class="absolute inset-0 flex items-center justify-center text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Add at least one asset to see a simulated curve.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="mt-2 text-[10px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>Drawing: pick a tool, click once for the first point and again for the second. Fib uses your two points as range.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- ADVANCED METRICS + RISK + HISTORY/SCENARIOS --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 pt-4 pb-4 sm:px-5 sm:pt-5 sm:pb-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-wrap items-center justify-between gap-3 mb-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-sm font-semibold tracking-tight"&gt;Advanced metrics &amp; risk&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500 max-w-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Synthetic stats from the curve plus simple VaR, stress tests, rough correlations and benchmark comparison.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span class="rounded-full bg-slate-950/80 px-2.5 py-1 text-[10px] uppercase tracking-[0.18em] text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Quant view</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="grid gap-4 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)] items-start text-[11px] sm:text-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;!-- Perf stats --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="space-y-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-2 gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-2.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Annualized return&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p id="metric-annualized" class="mt-1.5 text-sm font-semibold text-slate-100"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="mt-0.5 text-[10px] text-slate-500"&gt;From curve slope (very rough).&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-2.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Volatility&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p id="metric-volatility" class="mt-1.5 text-sm font-semibold text-slate-100"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="mt-0.5 text-[10px] text-slate-500"&gt;Annualized from daily swings.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-2 gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-2.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Sharpe ratio&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p id="metric-sharpe" class="mt-1.5 text-sm font-semibold text-slate-100"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="mt-0.5 text-[10px] text-slate-500"&gt;Return per unit of risk (r≈0%).&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-2.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Max drawdown&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p id="metric-maxdd" class="mt-1.5 text-sm font-semibold text-slate-100"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="mt-0.5 text-[10px] text-slate-500"&gt;Worst peak-to-trough drop.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;!-- VaR + correlations --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="space-y-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-2.5 space-y-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-baseline justify-between gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Value at Risk&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-[10px] text-slate-400"&gt;95% · 1d Monte Carlo&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex flex-wrap items-baseline gap-x-4 gap-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p id="metric-var-1d" class="text-sm font-semibold text-slate-100"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p id="metric-var-1d-pct" class="text-[11px] font-mono text-slate-400"&gt;--&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;p class="text-[10px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>5-day VaR: &lt;span id="metric-var-5d" class="font-mono text-slate-300"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center gap-2 mt-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label for="risk-stress-select"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Stress&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;select id="risk-stress-select"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="rounded-full border border-slate-700 bg-slate-950/80 px-2.5 py-1 text-[11px] text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="-0.10"&gt;-10% mild&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="-0.25" selected&gt;-25% moderate&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="-0.40"&gt;-40% crash&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;p class="mt-1 text-[10px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Scenario (&lt;span id="risk-stress-label" class="font-mono text-slate-300"&gt;-25%&lt;/span&gt;):</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span id="risk-stress-summary" class="font-mono text-slate-300"&gt;Add holdings to see crash impact.&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-2.5 space-y-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-baseline justify-between gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Correlation map&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-[10px] text-slate-400"&gt;Simulated · top assets&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div id="risk-corr-grid" class="mt-1 text-[9px] text-slate-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-[10px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>Add at least two assets to see simulated correlations.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;p id="risk-insight-text" class="mt-1 text-[10px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>We simulate 60 days of returns per coin based on 24h moves. For intuition only.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- HISTORY &amp; SCENARIOS --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-4 border-t border-slate-800 pt-4 grid gap-4 md:grid-cols-3 text-[11px] sm:text-xs"&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">              </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;!-- Performance vs indices --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-3 space-y-2.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Performance vs indices (rough)&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="space-y-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center justify-between gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-[10px] text-slate-400"&gt;1 month (est.)&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-month-portfolio" class="font-mono text-slate-100"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span class="text-[10px] text-slate-500"&gt;S&amp;amp;P:&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-month-sp" class="font-mono text-slate-300"&gt;~2%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span class="text-[10px] text-slate-500"&gt;Nasdaq:&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-month-nasdaq" class="font-mono text-slate-300"&gt;~2.5%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center justify-between gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-[10px] text-slate-400"&gt;3 months (est.)&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-quarter-portfolio" class="font-mono text-slate-100"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span class="text-[10px] text-slate-500"&gt;S&amp;amp;P:&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-quarter-sp" class="font-mono text-slate-300"&gt;~5%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span class="text-[10px] text-slate-500"&gt;Nasdaq:&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-quarter-nasdaq" class="font-mono text-slate-300"&gt;~6.5%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center justify-between gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-[10px] text-slate-400"&gt;1 year (est.)&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-year-portfolio" class="font-mono text-slate-100"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span class="text-[10px] text-slate-500"&gt;S&amp;amp;P:&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-year-sp" class="font-mono text-slate-300"&gt;~8%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span class="text-[10px] text-slate-500"&gt;Nasdaq:&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;span id="perf-year-nasdaq" class="font-mono text-slate-300"&gt;~11%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-2 text-[10px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Uses your synthetic 30-day curve for portfolio; index numbers are just ballpark long-run averages.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;!-- Strategy Backtester --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-900/70 px-3 py-3 space-y-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-baseline justify-between gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Strategy Backtester&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;span class="text-[10px] text-slate-400"&gt;Simulated (Synthetic)&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="space-y-2.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="grid grid-cols-2 gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;label class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Strategy&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;select id="bt-strategy" class="w-full rounded-lg border border-slate-700 bg-slate-900 px-2 py-1.5 text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option value="hold"&gt;Buy &amp; Hold&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option value="sma_cross"&gt;SMA Cross (20/50)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option value="rsi_strat"&gt;RSI Reversal (30/70)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option value="bollinger"&gt;BB Breakout&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;label class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Period&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;select id="bt-period" class="w-full rounded-lg border border-slate-700 bg-slate-900 px-2 py-1.5 text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option value="90"&gt;90 Days&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option value="180"&gt;180 Days&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;option value="365" selected&gt;1 Year&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button id="bt-run-btn" type="button" class="w-full rounded-lg bg-indigo-500/90 px-3 py-2 text-xs font-medium text-white shadow-sm shadow-indigo-500/30 hover:bg-indigo-400 transition"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Run Backtest</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;!-- Results --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div id="bt-results" class="hidden space-y-3 pt-2 border-t border-slate-800/50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-3 gap-2 text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div class="bg-slate-950/50 rounded p-1.5 border border-slate-800/50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;div class="text-[9px] uppercase tracking-wider text-slate-500"&gt;Sharpe&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;div id="bt-sharpe" class="text-xs font-mono text-slate-200 mt-0.5"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div class="bg-slate-950/50 rounded p-1.5 border border-slate-800/50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;div class="text-[9px] uppercase tracking-wider text-slate-500"&gt;Sortino&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;div id="bt-sortino" class="text-xs font-mono text-slate-200 mt-0.5"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;div class="bg-slate-950/50 rounded p-1.5 border border-slate-800/50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;div class="text-[9px] uppercase tracking-wider text-slate-500"&gt;Max DD&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;div id="bt-maxdd" class="text-xs font-mono text-rose-300 mt-0.5"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="h-24 w-full bg-slate-900/30 rounded border border-slate-800/50 relative overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;canvas id="bt-chart" class="absolute inset-0 w-full h-full"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-[9px] text-slate-500 text-center leading-relaxed"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;span class="inline-block w-2 h-2 rounded-full bg-indigo-400 mr-1"&gt;&lt;/span&gt;Strategy</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;span class="inline-block w-2 h-2 rounded-full bg-slate-600 ml-2 mr-1"&gt;&lt;/span&gt;Buy &amp; Hold</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;!-- Scenario Modeller --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="rounded-xl border border-slate-800 bg-slate-950/70 px-3 py-3 space-y-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-baseline justify-between gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;p class="uppercase tracking-[0.18em] text-[9px] text-slate-500"&gt;Scenario modeller&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;span class="text-[10px] text-slate-400"&gt;Market shocks&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;form id="scenario-form" class="space-y-2.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label for="scenario-amount"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Extra capital&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input id="scenario-amount" type="number" min="0" step="100"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>placeholder="e.g. 5000"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="w-full rounded-lg border border-slate-700 bg-slate-900 px-2 py-1.5 text-xs text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label for="scenario-move"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Market move&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;select id="scenario-move"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="w-full rounded-lg border border-slate-700 bg-slate-900 px-2 py-1.5 text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-emerald-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="-0.10"&gt;-10% mild risk-off&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="-0.25" selected&gt;-25% recession scare&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="-0.40"&gt;-40% crash&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="0.10"&gt;+10% relief rally&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="0.30"&gt;+30% altseason burst&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;button type="submit"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                          </span>class="w-full rounded-lg bg-emerald-500/90 px-3 py-2 text-xs font-medium text-slate-950 shadow-sm shadow-emerald-500/30 hover:bg-emerald-400 transition"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Run scenario</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/form&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="pt-2 border-t border-slate-800/50 space-y-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center justify-between"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-[10px] text-slate-500"&gt;Future value&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span id="scenario-result-value" class="font-mono text-xs text-slate-100"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex items-center justify-between"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-[10px] text-slate-500"&gt;P/L vs today&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span id="scenario-result-pnl" class="font-mono text-xs text-slate-100"&gt;--&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;p id="scenario-note" class="text-[9px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Uses a simple linear shock on your current portfolio + extra capital.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- HOLDINGS TABLE --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-3 pt-4 pb-3 sm:px-5 sm:pt-5 sm:pb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-wrap items-baseline justify-between gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-sm font-semibold tracking-tight"&gt;Portfolio holdings&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Aggregated positions and P/L.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-3 border-t border-slate-800 pt-3 sm:pt-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="-mx-3 sm:mx-0 overflow-x-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;table class="min-w-full border-separate border-spacing-y-1 text-xs sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;thead class="text-[10px] sm:text-[11px] uppercase tracking-[0.18em] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;th class="px-3 py-2 text-left font-medium"&gt;Asset&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;th class="px-3 py-2 text-right font-medium"&gt;Amount&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;th class="px-3 py-2 text-right font-medium"&gt;Price&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;th class="px-3 py-2 text-right font-medium"&gt;Value&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;th class="px-3 py-2 text-right font-medium"&gt;P/L&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;th class="px-3 py-2 text-right font-medium"&gt;Alloc&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;th class="px-3 py-2 text-right font-medium"&gt;&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/thead&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;tbody id="holdings-body"&gt;&lt;/tbody&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/table&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;p id="no-holdings" class="mt-3 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>No positions yet. Add one in the panel on the right.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- RIGHT COLUMN --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="space-y-6"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- ADD / EDIT POSITION --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;header class="flex items-start justify-between gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 id="asset-form-title" class="text-sm font-semibold tracking-tight"&gt;Add position&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500"&gt;Everything stays local in your browser.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span class="hidden sm:inline-flex items-center rounded-full border border-slate-700 bg-slate-950/80 px-2.5 py-1 text-[10px] uppercase tracking-[0.18em] text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Local only</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/header&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;form id="asset-form" class="mt-3 space-y-3 text-xs sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="space-y-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label for="asset-select"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="block text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;Asset&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;input id="asset-search" type="text" placeholder="Search coin..."</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="w-full mb-1.5 rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-2 text-xs text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;select id="asset-select"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="w-full rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-2 text-xs sm:text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="grid grid-cols-2 gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="space-y-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;label for="asset-amount"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>class="block text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;Amount&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;input id="asset-amount" type="number" min="0" step="0.00000001" placeholder="0.00"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>class="w-full rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-2 text-xs sm:text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="space-y-1.5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;label for="asset-buy-price"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>class="block text-[11px] font-medium uppercase tracking-[0.18em] text-slate-400"&gt;Buy price&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;div class="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input id="asset-buy-price" type="number" min="0" step="0.01" placeholder="Use market"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>class="flex-1 rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-2 text-xs sm:text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;select id="asset-entry-currency"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="w-20 rounded-xl border border-slate-700 bg-slate-900/70 px-2 py-2 text-xs sm:text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="usd" selected&gt;USD&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="eur"&gt;EUR&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="gbp"&gt;GBP&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="jpy"&gt;JPY&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="aud"&gt;AUD&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>&lt;option value="cad"&gt;CAD&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;p id="asset-form-error" class="text-[11px] text-rose-400 hidden"&gt;&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button type="submit"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>class="w-full inline-flex items-center justify-center rounded-xl bg-emerald-500/90 px-3 py-2.5 text-xs sm:text-sm font-medium text-slate-950 shadow-sm shadow-emerald-500/40 hover:bg-emerald-400 transition"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span id="asset-submit-label"&gt;Add position&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button type="button" id="asset-cancel-edit"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>class="hidden w-full text-[11px] text-slate-400 underline-offset-4 hover:text-slate-200 hover:underline"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Cancel editing</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;p class="text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Tip: leave &lt;span class="font-medium"&gt;Buy price&lt;/span&gt; empty to use current market as cost basis.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/form&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- ALLOCATION MINI --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;header class="flex items-center justify-between gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-sm font-semibold tracking-tight"&gt;Allocation&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500"&gt;Where your capital sits.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span class="rounded-full bg-slate-950/80 px-2.5 py-1 text-[10px] uppercase tracking-[0.18em] text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Exposure</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/header&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="allocation-list" class="mt-3 space-y-2 text-xs sm:text-sm"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="allocation-empty" class="mt-2 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>Once you add assets, you'll see a simple breakdown here.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- PRICE ALERTS --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;header class="flex items-center justify-between gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-sm font-semibold tracking-tight"&gt;Price alerts&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Get a toast + sound when a coin hits your level. Alerts stored locally.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;span class="rounded-full bg-slate-950/80 px-2.5 py-1 text-[10px] uppercase tracking-[0.18em] text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Beep on trigger</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/header&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;form id="alerts-form" class="mt-3 grid grid-cols-2 gap-2 text-[11px] sm:text-xs items-end"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="col-span-2 space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label for="alerts-asset"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Asset&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;select id="alerts-asset"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="w-full rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-1.5 text-xs text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label for="alerts-direction"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Direction&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;select id="alerts-direction"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="w-full rounded-xl border border-slate-700 bg-slate-950/70 px-2 py-1.5 text-xs text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;option value="above"&gt;Above (≥)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;option value="below"&gt;Below (≤)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="space-y-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label for="alerts-price"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Target price&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;input id="alerts-price" type="number" min="0" step="0.0001" placeholder="e.g. 50000"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="w-full rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-1.5 text-xs text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="col-span-2 flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;input id="alerts-repeat" type="checkbox" checked</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="h-3.5 w-3.5 rounded border-slate-600 bg-slate-950 text-emerald-500 focus:ring-emerald-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label for="alerts-repeat" class="text-[10px] text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Repeat alert (uncheck for one-shot; stays visible after trigger).</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="col-span-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button type="submit"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="w-full inline-flex items-center justify-center rounded-xl bg-slate-100 px-3 py-2 text-xs font-medium text-slate-950 hover:bg-white/90 transition"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Add alert</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/form&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-3 border-t border-slate-800 pt-3 sm:pt-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;p id="alerts-empty" class="text-[11px] text-slate-500"&gt;No alerts yet. Add one above.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;ul id="alerts-list" class="mt-2 space-y-2 text-xs sm:text-sm"&gt;&lt;/ul&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- NEWS TICKER --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;header class="flex items-center justify-between gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-sm font-semibold tracking-tight"&gt;News ticker&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Horizontal feed with mini charts; filter by coin.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div class="flex flex-col items-end gap-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label for="news-coin-filter"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="text-[9px] uppercase tracking-[0.18em] text-slate-500"&gt;Filter&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;select id="news-coin-filter"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="rounded-full border border-slate-700 bg-slate-950/80 px-2.5 py-1 text-[11px] text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>&lt;option value="all"&gt;All&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/header&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-3 border-t border-slate-800 pt-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div id="news-strip"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                   </span>class="flex gap-3 overflow-x-auto scroll-smooth snap-x snap-mandatory pb-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- cards via JS --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;p id="news-empty" class="mt-2 text-[11px] text-slate-500"&gt;Loading news…&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;!-- WATCHLIST --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;section class="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 sm:px-5 sm:py-5"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;header class="flex items-start justify-between gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-sm font-semibold tracking-tight"&gt;Watchlist&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mt-1 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>Coins you're tracking but not necessarily holding.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/header&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;form id="watchlist-form" class="mt-3 flex flex-col sm:flex-row gap-2 text-xs sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;select id="watchlist-select"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>class="flex-1 rounded-xl border border-slate-700 bg-slate-950/70 px-3 py-2 text-xs sm:text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-1 focus:ring-offset-slate-950"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;button type="submit"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                      </span>class="inline-flex items-center justify-center rounded-xl bg-slate-100 px-3 py-2 text-xs sm:text-sm font-medium text-slate-950 hover:bg-white/90 transition"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Add</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/form&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-3 border-t border-slate-800 pt-3 sm:pt-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;p id="watchlist-empty" class="text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>No watchlist yet. Add one above.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>&lt;ul id="watchlist-list" class="mt-1 space-y-2 text-xs sm:text-sm"&gt;&lt;/ul&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;/section&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/section&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/main&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;footer class="border-t border-slate-900 py-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="max-w-6xl mx-auto px-4 sm:px-6 flex flex-col sm:flex-row items-center justify-between gap-2 text-[11px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;p&gt;All data stored locally. Prices via public CoinGecko + CryptoCompare APIs.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;p&gt;For experimentation only – not investment advice.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/footer&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1">/* ---------------------- Static universe &amp; state ---------------------- */</span></p>
<p class="p1"><span class="s1">const COINS = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"bitcoin",symbol:"BTC",name:"Bitcoin"},{id:"ethereum",symbol:"ETH",name:"Ethereum"},{id:"crypto-com-chain",symbol:"CRO",name:"Cronos"},{id:"tether",symbol:"USDT",name:"Tether"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"binancecoin",symbol:"BNB",name:"BNB"},{id:"solana",symbol:"SOL",name:"Solana"},{id:"usd-coin",symbol:"USDC",name:"USDC"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"ripple",symbol:"XRP",name:"XRP"},{id:"toncoin",symbol:"TON",name:"Toncoin"},{id:"dogecoin",symbol:"DOGE",name:"Dogecoin"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"cardano",symbol:"ADA",name:"Cardano"},{id:"shiba-inu",symbol:"SHIB",name:"Shiba Inu"},{id:"avalanche-2",symbol:"AVAX",name:"Avalanche"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"tron",symbol:"TRX",name:"TRON"},{id:"polkadot",symbol:"DOT",name:"Polkadot"},{id:"bitcoin-cash",symbol:"BCH",name:"Bitcoin Cash"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"chainlink",symbol:"LINK",name:"Chainlink"},{id:"near",symbol:"NEAR",name:"NEAR Protocol"},{id:"matic-network",symbol:"MATIC",name:"Polygon"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"litecoin",symbol:"LTC",name:"Litecoin"},{id:"dai",symbol:"DAI",name:"Dai"},{id:"leo-token",symbol:"LEO",name:"LEO Token"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"uniswap",symbol:"UNI",name:"Uniswap"},{id:"internet-computer",symbol:"ICP",name:"Internet Computer"},{id:"ethereum-classic",symbol:"ETC",name:"Ethereum Classic"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"aptos",symbol:"APT",name:"Aptos"},{id:"render-token",symbol:"RNDR",name:"Render"},{id:"hedera-hashgraph",symbol:"HBAR",name:"Hedera"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"stellar",symbol:"XLM",name:"Stellar"},{id:"cosmos",symbol:"ATOM",name:"Cosmos"},{id:"monero",symbol:"XMR",name:"Monero"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"arbitrum",symbol:"ARB",name:"Arbitrum"},{id:"kaspa",symbol:"KAS",name:"Kaspa"},{id:"filecoin",symbol:"FIL",name:"Filecoin"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"maker",symbol:"MKR",name:"Maker"},{id:"stx",symbol:"STX",name:"Stacks"},{id:"vechain",symbol:"VET",name:"VeChain"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"optimism",symbol:"OP",name:"Optimism"},{id:"the-graph",symbol:"GRT",name:"The Graph"},{id:"injective-protocol",symbol:"INJ",name:"Injective"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"aave",symbol:"AAVE",name:"Aave"},{id:"theta-token",symbol:"THETA",name:"Theta Network"},{id:"fantom",symbol:"FTM",name:"Fantom"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"lidodao",symbol:"LDO",name:"Lido DAO"},{id:"thorchain",symbol:"RUNE",name:"THORChain"},{id:"arweave",symbol:"AR",name:"Arweave"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"fetch-ai",symbol:"FET",name:"Fetch.ai"},{id:"algorand",symbol:"ALGO",name:"Algorand"},{id:"quant-network",symbol:"QNT",name:"Quant"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"gala",symbol:"GALA",name:"Gala"},{id:"flow",symbol:"FLOW",name:"Flow"},{id:"eos",symbol:"EOS",name:"EOS"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"multiversx",symbol:"EGLD",name:"MultiversX"},{id:"axie-infinity",symbol:"AXS",name:"Axie Infinity"},{id:"sandbox",symbol:"SAND",name:"The Sandbox"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"neo",symbol:"NEO",name:"NEO"},{id:"tezos",symbol:"XTZ",name:"Tezos"},{id:"chiliz",symbol:"CHZ",name:"Chiliz"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"kava",symbol:"KAVA",name:"Kava"},{id:"mina-protocol",symbol:"MINA",name:"Mina"},{id:"klay-token",symbol:"KLAY",name:"Klaytn"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"iota",symbol:"IOTA",name:"IOTA"},{id:"decentraland",symbol:"MANA",name:"Decentraland"},{id:"kucoin-shares",symbol:"KCS",name:"KuCoin Token"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"curve-dao-token",symbol:"CRV",name:"Curve DAO"},{id:"frax-share",symbol:"FXS",name:"Frax Share"},{id:"ecash",symbol:"XEC",name:"eCash"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"bittorrent",symbol:"BTT",name:"BitTorrent"},{id:"zcash",symbol:"ZEC",name:"Zcash"},{id:"trust-wallet-token",symbol:"TWT",name:"Trust Wallet"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"havven",symbol:"SNX",name:"Synthetix"},{id:"conflux-token",symbol:"CFX",name:"Conflux"},{id:"pepe",symbol:"PEPE",name:"Pepe"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"floki",symbol:"FLOKI",name:"Floki"},{id:"gmx",symbol:"GMX",name:"GMX"},{id:"rocket-pool",symbol:"RPL",name:"Rocket Pool"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"terra-luna-2",symbol:"LUNA",name:"Terra"},{id:"gatechain-token",symbol:"GT",name:"GateToken"},{id:"oasis-network",symbol:"ROSE",name:"Oasis Network"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"blur",symbol:"BLUR",name:"Blur"},{id:"sui",symbol:"SUI",name:"Sui"},{id:"pax-gold",symbol:"PAXG",name:"PAX Gold"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"compound-governance-token",symbol:"COMP",name:"Compound"},{id:"zilliqa",symbol:"ZIL",name:"Zilliqa"},{id:"dash",symbol:"DASH",name:"Dash"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"1inch",symbol:"1INCH",name:"1inch"},{id:"loopring",symbol:"LRC",name:"Loopring"},{id:"pancakeswap-token",symbol:"CAKE",name:"PancakeSwap"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"basic-attention-token",symbol:"BAT",name:"Basic Attention Token"},{id:"enjincoin",symbol:"ENJ",name:"Enjin Coin"},{id:"qtum",symbol:"QTUM",name:"Qtum"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"mask-network",symbol:"MASK",name:"Mask Network"},{id:"celo",symbol:"CELO",name:"Celo"},{id:"nem",symbol:"XEM",name:"NEM"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"osmosis",symbol:"OSMO",name:"Osmosis"},{id:"convex-finance",symbol:"CVX",name:"Convex Finance"},{id:"yearn-finance",symbol:"YFI",name:"yearn.finance"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"ankr",symbol:"ANKR",name:"Ankr"},{id:"ravencoin",symbol:"RVN",name:"Ravencoin"},{id:"0x",symbol:"ZRX",name:"0x Protocol"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"stepn",symbol:"GMT",name:"STEPN"},{id:"wax",symbol:"WAXP",name:"WAX"},{id:"audius",symbol:"AUDIO",name:"Audius"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"siacoin",symbol:"SC",name:"Siacoin"},{id:"holo",symbol:"HOT",name:"Holo"},{id:"band-protocol",symbol:"BAND",name:"Band Protocol"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"ontology",symbol:"ONT",name:"Ontology"},{id:"iostoken",symbol:"IOST",name:"IOST"},{id:"digibyte",symbol:"DGB",name:"DigiByte"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"kadena",symbol:"KDA",name:"Kadena"},{id:"moonbeam",symbol:"GLMR",name:"Moonbeam"},{id:"skale",symbol:"SKL",name:"SKALE"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"livepeer",symbol:"LPT",name:"Livepeer"},{id:"icon",symbol:"ICX",name:"ICON"},{id:"secret",symbol:"SCRT",name:"Secret"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"just",symbol:"JST",name:"JUST"},{id:"cartesi",symbol:"CTSI",name:"Cartesi"},{id:"api3",symbol:"API3",name:"API3"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"biconomy",symbol:"BICO",name:"Biconomy"},{id:"galxe",symbol:"GAL",name:"Galxe"},{id:"moonriver",symbol:"MOVR",name:"Moonriver"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"origin-protocol",symbol:"OGN",name:"Origin Protocol"},{id:"chromia",symbol:"CHR",name:"Chromia"},{id:"superfarm",symbol:"SUPER",name:"SuperVerse"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"coti",symbol:"COTI",name:"COTI"},{id:"syscoin",symbol:"SYS",name:"Syscoin"},{id:"hive",symbol:"HIVE",name:"Hive"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"status",symbol:"SNT",name:"Status"},{id:"dent",symbol:"DENT",name:"Dent"},{id:"ocean-protocol",symbol:"OCEAN",name:"Ocean Protocol"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"power-ledger",symbol:"POWR",name:"Powerledger"},{id:"civic",symbol:"CVC",name:"Civic"},{id:"stormx",symbol:"STMX",name:"StormX"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"numeraire",symbol:"NMR",name:"Numeraire"},{id:"request-network",symbol:"REQ",name:"Request"},{id:"metal",symbol:"MTL",name:"Metal DAO"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"nkn",symbol:"NKN",name:"NKN"},{id:"funfair",symbol:"FUN",name:"FUNToken"},{id:"rlc",symbol:"RLC",name:"iExec RLC"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"ark",symbol:"ARK",name:"Ark"},{id:"verge",symbol:"XVG",name:"Verge"},{id:"steem",symbol:"STEEM",name:"Steem"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"bancor",symbol:"BNT",name:"Bancor"},{id:"augur",symbol:"REP",name:"Augur"},{id:"nano",symbol:"XNO",name:"Nano"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"kyber-network-crystal",symbol:"KNC",name:"Kyber Network"},{id:"uma",symbol:"UMA",name:"UMA"},{id:"sushi",symbol:"SUSHI",name:"SushiSwap"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"balancer",symbol:"BAL",name:"Balancer"},{id:"badger-dao",symbol:"BADGER",name:"Badger DAO"},{id:"perpetual-protocol",symbol:"PERP",name:"Perpetual Protocol"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"reef",symbol:"REEF",name:"Reef"},{id:"dodo",symbol:"DODO",name:"DODO"},{id:"alpha-finance",symbol:"ALPHA",name:"Stella"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"prom",symbol:"PROM",name:"Prom"},{id:"linear",symbol:"LINA",name:"Linear"},{id:"idex",symbol:"IDEX",name:"IDEX"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"polymath",symbol:"POLY",name:"Polymath"},{id:"bakerytoken",symbol:"BAKE",name:"BakeryToken"},{id:"burger-swap",symbol:"BURGER",name:"BurgerCities"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"cream-2",symbol:"CREAM",name:"Cream Finance"},{id:"farm",symbol:"FARM",name:"Harvest Finance"},{id:"keep-network",symbol:"KEEP",name:"Keep Network"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"nu-cypher",symbol:"NU",name:"NuCypher"},{id:"threshold-network-token",symbol:"T",name:"Threshold"},{id:"ren",symbol:"REN",name:"Ren"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"raydium",symbol:"RAY",name:"Raydium"},{id:"serum",symbol:"SRM",name:"Serum"},{id:"star-atlas-dao",symbol:"POLIS",name:"Star Atlas DAO"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"orca",symbol:"ORCA",name:"Orca"},{id:"marinade-staked-sol",symbol:"MSOL",name:"Marinade Staked SOL"},{id:"lido-staked-sol",symbol:"STSOL",name:"Lido Staked SOL"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"marlin",symbol:"POND",name:"Marlin"},{id:"lcx",symbol:"LCX",name:"LCX"},{id:"dia-data",symbol:"DIA",name:"DIA"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"covalent",symbol:"CQT",name:"Covalent"},{id:"tellor",symbol:"TRB",name:"Tellor"},{id:"radicle",symbol:"RAD",name:"Radicle"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"gitcoin",symbol:"GTC",name:"Gitcoin"},{id:"ens",symbol:"ENS",name:"Ethereum Name Service"},{id:"space-id",symbol:"ID",name:"Space ID"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"cyberconnect",symbol:"CYBER",name:"CyberConnect"},{id:"hooked-protocol",symbol:"HOOK",name:"Hooked Protocol"},{id:"educational-coin",symbol:"EDU",name:"Open Campus"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"worldcoin-wld",symbol:"WLD",name:"Worldcoin"},{id:"sei-network",symbol:"SEI",name:"Sei"},{id:"ordinals",symbol:"ORDI",name:"ORDI"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"bonk",symbol:"BONK",name:"Bonk"},{id:"akash-network",symbol:"AKT",name:"Akash Network"},{id:"singularitynet",symbol:"AGIX",name:"SingularityNET"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"wootrade",symbol:"WOO",name:"WOO"},{id:"ronin",symbol:"RON",name:"Ronin"},{id:"pyth-network",symbol:"PYTH",name:"Pyth Network"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"jupiter-exchange-solana",symbol:"JUP",name:"Jupiter"},{id:"manta-network",symbol:"MANTA",name:"Manta Network"},{id:"dymension",symbol:"DYM",name:"Dymension"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"altlayer",symbol:"ALT",name:"AltLayer"},{id:"beam-2",symbol:"BEAM",name:"Beam"},{id:"arkham",symbol:"ARKM",name:"Arkham"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"starknet",symbol:"STRK",name:"Starknet"},{id:"ethena",symbol:"ENA",name:"Ethena"},{id:"dogwifhat",symbol:"WIF",name:"dogwifhat"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"my-neighbor-alice",symbol:"ALICE",name:"My Neighbor Alice"},{id:"illuvium",symbol:"ILV",name:"Illuvium"},{id:"vulcan-forged",symbol:"PYR",name:"Vulcan Forged"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"yield-guild-games",symbol:"YGG",name:"Yield Guild Games"},{id:"star-atlas",symbol:"ATLAS",name:"Star Atlas"},{id:"aurora-near",symbol:"AURORA",name:"Aurora"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"metis-token",symbol:"METIS",name:"Metis"},{id:"boba-network",symbol:"BOBA",name:"Boba Network"},{id:"ribbon-finance",symbol:"RBN",name:"Ribbon Finance"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"hashflow",symbol:"HFT",name:"Hashflow"},{id:"magic",symbol:"MAGIC",name:"Magic"},{id:"looksrare",symbol:"LOOKS",name:"LooksRare"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"x2y2",symbol:"X2Y2",name:"X2Y2"},{id:"alchemy-pay",symbol:"ACH",name:"Alchemy Pay"},{id:"rss3",symbol:"RSS3",name:"RSS3"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"stargate-finance",symbol:"STG",name:"Stargate Finance"},{id:"synapse-2",symbol:"SYN",name:"Synapse"},{id:"hop-protocol",symbol:"HOP",name:"Hop Protocol"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"across-protocol",symbol:"ACX",name:"Across Protocol"},{id:"celer-network",symbol:"CELR",name:"Celer Network"},{id:"layerzero",symbol:"ZRO",name:"LayerZero"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"eigenlayer",symbol:"EIGEN",name:"EigenLayer"},{id:"ether-fi",symbol:"ETHFI",name:"ether.fi"},{id:"renzo",symbol:"REZ",name:"Renzo"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"puffer",symbol:"PUFFER",name:"Puffer"},{id:"kelp-dao",symbol:"KELP",name:"Kelp DAO"},{id:"swell-network",symbol:"SWELL",name:"Swell"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"mantle",symbol:"MNT",name:"Mantle"},{id:"blast",symbol:"BLAST",name:"Blast"},{id:"linea",symbol:"LINEA",name:"Linea"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"base",symbol:"BASE",name:"Base"},{id:"zksync",symbol:"ZK",name:"zkSync"},{id:"scroll",symbol:"SCROLL",name:"Scroll"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"taiko",symbol:"TAIKO",name:"Taiko"},{id:"aztec",symbol:"AZTEC",name:"Aztec"},{id:"fuel",symbol:"FUEL",name:"Fuel"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"aleo",symbol:"ALEO",name:"Aleo"},{id:"ironfish",symbol:"IRON",name:"Iron Fish"},{id:"namada",symbol:"NAM",name:"Namada"},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>{id:"penumbra",symbol:"PEN",name:"Penumbra"},{id:"berachain",symbol:"BERA",name:"Berachain"},{id:"monad",symbol:"MONAD",name:"Monad"}</span></p>
<p class="p1"><span class="s1">];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const STORAGE_KEYS = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>portfolio: "minimal-crypto-portfolio-v2-portfolio",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>watchlist: "minimal-crypto-portfolio-v2-watchlist",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alerts:<span class="Apple-converted-space">    </span>"minimal-crypto-portfolio-v2-alerts",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fx:<span class="Apple-converted-space">        </span>"minimal-crypto-fx-rates",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>benchmarks:"minimal-crypto-benchmarks"</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const CURRENCY_CONFIG = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>usd: { locale: "en-US", currency: "USD", symbol: "$", name: "USD" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>eur: { locale: "de-DE", currency: "EUR", symbol: "€", name: "EUR" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>gbp: { locale: "en-GB", currency: "GBP", symbol: "£", name: "GBP" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>jpy: { locale: "ja-JP", currency: "JPY", symbol: "¥", name: "JPY" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>aud: { locale: "en-AU", currency: "AUD", symbol: "A$", name: "AUD" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>cad: { locale: "en-CA", currency: "CAD", symbol: "C$", name: "CAD" }</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Very rough benchmark assumptions</span></p>
<p class="p1"><span class="s1">const BENCHMARK_RETURNS = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>month: <span class="Apple-converted-space">  </span>{ sp: 0.02,<span class="Apple-converted-space">  </span>nasdaq: 0.025 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>quarter: { sp: 0.05,<span class="Apple-converted-space">  </span>nasdaq: 0.065 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>year:<span class="Apple-converted-space">    </span>{ sp: 0.08,<span class="Apple-converted-space">  </span>nasdaq: 0.11 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>hasLive: false</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const state = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>portfolio: [],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>watchlist: [],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alerts: [],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>priceData: {},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>timeframe: "24h",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>chartSeries: { "24h": null, "7d": null, "30d": null },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>chartSettings: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>chartType: "line",<span class="Apple-converted-space">  </span>// 'line' | 'candles' | 'bars'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>indicators: { bb: false, rsi: false, macd: false },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>drawing: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>tool: "none", <span class="Apple-converted-space">    </span>// 'none' | 'trendline' | 'fib'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>trendlines: [], <span class="Apple-converted-space">  </span>// { p1:{xNorm,yNorm}, p2:{xNorm,yNorm} }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>fibs: [], <span class="Apple-converted-space">        </span>// { top:{xNorm,yNorm}, bottom:{xNorm,yNorm} }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>pending: null <span class="Apple-converted-space">    </span>// { type, first:{xNorm,yNorm} }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>lastPortfolioData: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>news: [],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>newsFilter: "all",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>newsAutoScrollIndex: 0,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>newsAutoScrollTimer: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>currency: "usd",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fxRates: { usd: 1, eur: 0.92, gbp: 0.79, jpy: 150, aud: 1.5, cad: 1.35 } // Default fallbacks</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">let audioCtx = null;</span></p>
<p class="p1"><span class="s1">let chartLayout = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- DOM refs ---------------------- */</span></p>
<p class="p1"><span class="s1">const el = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>totalValue: document.getElementById("total-value"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>totalCost: document.getElementById("total-cost"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>totalPnl: document.getElementById("total-pnl"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>totalPnlPct: document.getElementById("total-pnl-pct"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetsCount: document.getElementById("assets-count"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>dayPnl: document.getElementById("day-pnl"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>dayPnlPct: document.getElementById("day-pnl-pct"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>bestName: document.getElementById("best-asset-name"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>bestChange: document.getElementById("best-asset-change"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>worstName: document.getElementById("worst-asset-name"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>worstChange: document.getElementById("worst-asset-change"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>holdingsBody: document.getElementById("holdings-body"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>noHoldings: document.getElementById("no-holdings"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>allocationList: document.getElementById("allocation-list"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>allocationEmpty: document.getElementById("allocation-empty"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>watchlistEmpty: document.getElementById("watchlist-empty"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>watchlistList: document.getElementById("watchlist-list"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>priceStatus: document.getElementById("price-status"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>lastUpdated: document.getElementById("last-updated"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>refreshBtn: document.getElementById("refresh-btn"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>refreshDot: document.getElementById("refresh-dot"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>globalCurrencySelect: document.getElementById("global-currency-select"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>chartCanvas: document.getElementById("performance-chart"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>chartEmpty: document.getElementById("chart-empty"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetFormTitle: document.getElementById("asset-form-title"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetForm: document.getElementById("asset-form"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetSearch: document.getElementById("asset-search"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetSelect: document.getElementById("asset-select"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetAmount: document.getElementById("asset-amount"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetBuyPrice: document.getElementById("asset-buy-price"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetEntryCurrency: document.getElementById("asset-entry-currency"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetSubmitLabel: document.getElementById("asset-submit-label"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetCancelEdit: document.getElementById("asset-cancel-edit"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>assetFormError: document.getElementById("asset-form-error"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>watchlistForm: document.getElementById("watchlist-form"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>watchlistSelect: document.getElementById("watchlist-select"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>metricAnnualized: document.getElementById("metric-annualized"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>metricSharpe: document.getElementById("metric-sharpe"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>metricMaxDD: document.getElementById("metric-maxdd"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>metricVolatility: document.getElementById("metric-volatility"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>metricVaR1d: document.getElementById("metric-var-1d"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>metricVaR1dPct: document.getElementById("metric-var-1d-pct"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>metricVaR5d: document.getElementById("metric-var-5d"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>riskStressSelect: document.getElementById("risk-stress-select"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>riskStressLabel: document.getElementById("risk-stress-label"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>riskStressSummary: document.getElementById("risk-stress-summary"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>riskCorrGrid: document.getElementById("risk-corr-grid"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>riskInsightText: document.getElementById("risk-insight-text"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>scenarioForm: document.getElementById("scenario-form"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>scenarioAmount: document.getElementById("scenario-amount"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>scenarioMove: document.getElementById("scenario-move"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>scenarioResultValue: document.getElementById("scenario-result-value"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>scenarioResultPnl: document.getElementById("scenario-result-pnl"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>scenarioNote: document.getElementById("scenario-note"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alertsForm: document.getElementById("alerts-form"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alertsAsset: document.getElementById("alerts-asset"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alertsDirection: document.getElementById("alerts-direction"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alertsPrice: document.getElementById("alerts-price"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alertsRepeat: document.getElementById("alerts-repeat"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alertsList: document.getElementById("alerts-list"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>alertsEmpty: document.getElementById("alerts-empty"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>newsCoinFilter: document.getElementById("news-coin-filter"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>newsStrip: document.getElementById("news-strip"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>newsEmpty: document.getElementById("news-empty"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>indicatorBB: document.getElementById("indicator-bb"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>indicatorRSI: document.getElementById("indicator-rsi"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>indicatorMACD: document.getElementById("indicator-macd"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>drawToolSelect: document.getElementById("draw-tool-select"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>drawClear: document.getElementById("draw-clear"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfMonthPortfolio: document.getElementById("perf-month-portfolio"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfQuarterPortfolio: document.getElementById("perf-quarter-portfolio"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfYearPortfolio: document.getElementById("perf-year-portfolio"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfMonthSP: document.getElementById("perf-month-sp"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfQuarterSP: document.getElementById("perf-quarter-sp"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfYearSP: document.getElementById("perf-year-sp"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfMonthNasdaq: document.getElementById("perf-month-nasdaq"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfQuarterNasdaq: document.getElementById("perf-quarter-nasdaq"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>perfYearNasdaq: document.getElementById("perf-year-nasdaq"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>toastContainer: document.getElementById("toast-container"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fngValue: document.getElementById("fng-value"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fngLabel: document.getElementById("fng-label"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fngBar: document.getElementById("fng-bar"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btcDom: document.getElementById("btc-dom"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>altSeason: document.getElementById("alt-season"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>globalMcap: document.getElementById("global-mcap"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>altMcap: document.getElementById("alt-mcap"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btStrategy: document.getElementById("bt-strategy"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btPeriod: document.getElementById("bt-period"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btRunBtn: document.getElementById("bt-run-btn"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btResults: document.getElementById("bt-results"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btSharpe: document.getElementById("bt-sharpe"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btSortino: document.getElementById("bt-sortino"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btMaxDD: document.getElementById("bt-maxdd"),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>btChart: document.getElementById("bt-chart")</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">let editingCoinId = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Utils ---------------------- */</span></p>
<p class="p1"><span class="s1">function loadJson(key, fallback) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const raw = localStorage.getItem(key);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!raw) return fallback;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const parsed = JSON.parse(raw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return parsed ?? fallback;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} catch {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return fallback;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function saveJson(key, value) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>try { localStorage.setItem(key, JSON.stringify(value)); } catch {}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function formatCurrency(v, overrideCurrency) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!isFinite(v)) return "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const code = overrideCurrency || state.currency || "usd";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const cfg = CURRENCY_CONFIG[code] || CURRENCY_CONFIG.usd;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return v.toLocaleString(cfg.locale, {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>style: "currency",<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>currency: cfg.currency,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>minimumFractionDigits: 2,<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>maximumFractionDigits: 2<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function formatPercent(v) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!isFinite(v)) return "0.0%";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const sign = v &gt; 0 ? "+" : "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return sign + v.toFixed(2) + "%";</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function findCoinMeta(id) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return COINS.find(c =&gt; c.id === id) || null;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function defaultPortfolio() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{ id: "bitcoin",<span class="Apple-converted-space">  </span>symbol: "BTC",<span class="Apple-converted-space">  </span>name: "Bitcoin",<span class="Apple-converted-space">  </span>amount: 0.35, buyPrice: 26000 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{ id: "ethereum", symbol: "ETH",<span class="Apple-converted-space">  </span>name: "Ethereum", amount: 3.8,<span class="Apple-converted-space">  </span>buyPrice: 1800 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{ id: "solana", <span class="Apple-converted-space">  </span>symbol: "SOL",<span class="Apple-converted-space">  </span>name: "Solana", <span class="Apple-converted-space">  </span>amount: 45, <span class="Apple-converted-space">  </span>buyPrice: 22 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{ id: "tether", <span class="Apple-converted-space">  </span>symbol: "USDT", name: "Tether", <span class="Apple-converted-space">  </span>amount: 1500, buyPrice: 1 }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>];</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function loadPortfolio() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const data = loadJson(STORAGE_KEYS.portfolio, null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (data === null) return defaultPortfolio();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!Array.isArray(data)) return [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (data.length === 0) return [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return data</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.map(h =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const meta = findCoinMeta(h.id) || findCoinMeta(String(h.symbol || "").toLowerCase());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>id: meta ? meta.id : h.id,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>symbol: meta ? meta.symbol : (h.symbol || "").toUpperCase(),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>name: meta ? meta.name : (h.name || h.symbol || h.id),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>amount: Number(h.amount) || 0,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>buyPrice: Number(h.buyPrice) || 0</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.filter(h =&gt; h.amount &gt; 0);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function loadWatchlist() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const data = loadJson(STORAGE_KEYS.watchlist, ["cardano", "dogecoin"]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!Array.isArray(data)) return [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const ids = [...new Set(data)].filter(id =&gt; COINS.some(c =&gt; c.id === id));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return ids;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function loadAlerts() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const data = loadJson(STORAGE_KEYS.alerts, []);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!Array.isArray(data)) return [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return data.map(a =&gt; ({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>id: String(a.id || Date.now()),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>coinId: String(a.coinId || ""),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>symbol: String(a.symbol || ""),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>name: String(a.name || ""),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>direction: a.direction === "below" ? "below" : "above",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>target: Number(a.target) || 0,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>repeat: !!a.repeat,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>active: a.active !== false,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>lastTriggered: a.lastTriggered || null</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function persistPortfolio() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>saveJson(STORAGE_KEYS.portfolio, state.portfolio);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function persistWatchlist() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>saveJson(STORAGE_KEYS.watchlist, state.watchlist);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function persistAlerts() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>saveJson(STORAGE_KEYS.alerts, state.alerts);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function getDisplayPrice(coinId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const info = state.priceData[coinId];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!info) return null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const cur = state.currency;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (typeof info[cur] === "number") return info[cur];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (typeof info.usd === "number") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rate = state.fxRates[cur] || 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return info.usd * rate;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return null;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function getDisplayChange(coinId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const info = state.priceData[coinId];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!info) return null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const cur = state.currency;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const key = `${cur}_24h_change`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (typeof info[key] === "number") return info[key];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (typeof info.usd_24h_change === "number") return info.usd_24h_change;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return null;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function clamp(value, min = 0, max = 1) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return Math.min(max, Math.max(min, value));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function pseudoCorrelation(idA, idB) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const mix = (idA + idB).split("").reduce((acc, ch) =&gt; acc + ch.charCodeAt(0), 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return Math.sin(mix) * 0.9;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function seededRandom(seed) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>var x = Math.sin(seed++) * 10000;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return x - Math.floor(x);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function humanizeTimeAgo(timestamp) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!timestamp) return "just now";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const diff = Date.now() - timestamp;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const mins = Math.floor(diff / 60000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (mins &lt; 1) return "just now";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (mins &lt; 60) return `${mins}m ago`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const hours = Math.floor(mins / 60);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (hours &lt; 24) return `${hours}h ago`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const days = Math.floor(hours / 24);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return `${days}d ago`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function updateTrendClass(node, value) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!node) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>node.classList.remove("text-emerald-400", "text-emerald-300", "text-rose-400", "text-rose-300", "text-slate-300", "text-slate-400");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!isFinite(value) || value === 0) node.classList.add("text-slate-300");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>else if (value &gt; 0) node.classList.add("text-emerald-400");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>else node.classList.add("text-rose-400");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Portfolio calculations ---------------------- */</span></p>
<p class="p1"><span class="s1">function calculatePortfolio(portfolio, priceData) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const cur = state.currency || "usd";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rate = state.fxRates[cur] || 1; // Convert USD -&gt; Target</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let totalValue = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let totalCost = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let dayChangeAbs = 0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const detailed = portfolio.map(h =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const info = priceData[h.id] || {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const hasPrice = typeof info.usd === "number";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const priceUsd = hasPrice ? info.usd : (h.buyPrice || 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const changePct = typeof info.usd_24h_change === "number" ? info.usd_24h_change : 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const price = priceUsd * rate;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const buyPriceVal = (h.buyPrice || 0) * rate;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const amount = Number(h.amount) || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const value = amount * price;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const costPer = buyPriceVal &gt; 0 ? buyPriceVal : price;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const cost = amount * costPer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pnlAbs = value - cost;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const pnlPct = cost ? pnlAbs / cost * 100 : 0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>totalValue += value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>totalCost += cost;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>dayChangeAbs += value * (changePct / 100);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return { ...h, amount, price, value, cost, pnlAbs, pnlPct, change24hPct: changePct };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const dayChangePct = totalValue ? dayChangeAbs / totalValue * 100 : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const totalPnlAbs = totalValue - totalCost;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const totalPnlPct = totalCost ? totalPnlAbs / totalCost * 100 : 0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (totalValue &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>detailed.forEach(h =&gt; { h.allocationPct = h.value / totalValue * 100; });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>detailed.forEach(h =&gt; { h.allocationPct = 0; });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let best = null, worst = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const movers = detailed.filter(h =&gt; h.value &gt; 10 * rate &amp;&amp; isFinite(h.change24hPct));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (movers.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>movers.sort((a,b) =&gt; b.change24hPct - a.change24hPct);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>best = movers[0];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>worst = movers[movers.length - 1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>detailed.sort((a,b) =&gt; b.value - a.value);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>totals: { totalValue, totalCost, totalPnlAbs, totalPnlPct, dayChangeAbs, dayChangePct },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>holdings: detailed,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>best, worst</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Synthetic curve &amp; indicators ---------------------- */</span></p>
<p class="p1"><span class="s1">function generateSyntheticSeries(baseValue, points, timeframe) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!baseValue || !isFinite(baseValue)) return [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const series = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const base = Math.max(baseValue, 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let vol;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (timeframe === "24h") vol = 0.012;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>else if (timeframe === "7d") vol = 0.035;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>else vol = 0.06;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let v = base * (1 - vol * 0.8);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Seed based on baseValue so it doesn't jitter on refresh</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let seed = Math.floor(baseValue);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>for (let i=0;i&lt;points;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const drift = base * 0.0004;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Seeded random</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const noise = (seededRandom(seed + i) - 0.5) * 2 * vol * base;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>v = Math.max(base*0.4, v + drift + noise);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const t = i / Math.max(points-1,1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>series.push({ t, value: v });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (series.length) series[series.length-1].value = base;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return series;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function ensureChartSeries(timeframe, baseValue) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const points = timeframe === "24h" ? 60 : timeframe === "7d" ? 80 : 100;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const existing = state.chartSeries[timeframe];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!baseValue || !isFinite(baseValue)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.chartSeries[timeframe] = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!existing || !existing.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const s = generateSyntheticSeries(baseValue, points, timeframe);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.chartSeries[timeframe] = s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const last = existing[existing.length-1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const lastV = last &amp;&amp; isFinite(last.value) ? last.value : baseValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const factor = lastV ? baseValue / lastV : 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const scaled = existing.map(p =&gt; ({ t: p.t, value: p.value * factor }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSeries[timeframe] = scaled;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return scaled;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function computeIndicators(series) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const closes = series.map(p =&gt; p.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const n = closes.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const result = { bb: null, rsi: null, macd: null };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (n &lt; 5) return result;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const bbPeriod = 20, k = 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const upper = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const lower = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const middle = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (n &gt;= bbPeriod) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=bbPeriod-1;i&lt;n;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>let sum = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>for (let j=i-bbPeriod+1;j&lt;=i;j++) sum += closes[j];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const ma = sum / bbPeriod;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>let varSum = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>for (let j=i-bbPeriod+1;j&lt;=i;j++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const d = closes[j] - ma;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>varSum += d*d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const std = Math.sqrt(varSum / bbPeriod);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>middle[i] = ma;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>upper[i] = ma + k*std;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>lower[i] = ma - k*std;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>result.bb = { upper, lower, middle };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rsiPeriod = 14;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rsi = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (n &gt; rsiPeriod) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let gains=0, losses=0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=1;i&lt;=rsiPeriod;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const diff = closes[i]-closes[i-1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (diff&gt;=0) gains+=diff; else losses-=diff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let avgGain = gains/rsiPeriod;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let avgLoss = losses/rsiPeriod;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rsi[rsiPeriod] = avgLoss===0?100:100-100/(1+avgGain/avgLoss);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=rsiPeriod+1;i&lt;n;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const diff = closes[i]-closes[i-1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const gain = diff&gt;0?diff:0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const loss = diff&lt;0?-diff:0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>avgGain = (avgGain*(rsiPeriod-1)+gain)/rsiPeriod;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>avgLoss = (avgLoss*(rsiPeriod-1)+loss)/rsiPeriod;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!avgLoss) rsi[i]=100;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const rs = avgGain/avgLoss;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rsi[i] = 100-100/(1+rs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>result.rsi = rsi;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const fast=12, slow=26, signal=9;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (n &gt; slow+signal) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const emaFast = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const emaSlow = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const kFast = 2/(fast+1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const kSlow = 2/(slow+1);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let sumFast=0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=0;i&lt;fast;i++) sumFast+=closes[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>emaFast[fast-1]=sumFast/fast;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=fast;i&lt;n;i++) emaFast[i]=closes[i]*kFast+emaFast[i-1]*(1-kFast);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let sumSlow=0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=0;i&lt;slow;i++) sumSlow+=closes[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>emaSlow[slow-1]=sumSlow/slow;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=slow;i&lt;n;i++) emaSlow[i]=closes[i]*kSlow+emaSlow[i-1]*(1-kSlow);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const macd = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=0;i&lt;n;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (emaFast[i]!=null &amp;&amp; emaSlow[i]!=null) macd[i]=emaFast[i]-emaSlow[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const signalArr = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const kSig = 2/(signal+1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const firstIdx = macd.findIndex(v =&gt; v!=null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (firstIdx&gt;=0 &amp;&amp; n-firstIdx&gt;=signal) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>let sumSig=0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>for (let i=firstIdx;i&lt;firstIdx+signal;i++) sumSig+=macd[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>signalArr[firstIdx+signal-1]=sumSig/signal;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>for (let i=firstIdx+signal;i&lt;n;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>signalArr[i]=macd[i]*kSig+signalArr[i-1]*(1-kSig);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const hist = Array(n).fill(null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i=0;i&lt;n;i++) if (macd[i]!=null &amp;&amp; signalArr[i]!=null) hist[i]=macd[i]-signalArr[i];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>result.macd = { macd, signal: signalArr, hist };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return result;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">function computeSeriesMetrics(series) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!Array.isArray(series) || series.length&lt;2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return { annualizedReturn:NaN, volatility:NaN, sharpe:NaN, maxDrawdown:NaN };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const values = series.map(p=&gt;p.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const first = values[0], last = values[values.length-1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!first || !last) return { annualizedReturn:NaN, volatility:NaN, sharpe:NaN, maxDrawdown:NaN };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const returns = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>for (let i=1;i&lt;values.length;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const prev = values[i-1], curr = values[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (prev&gt;0 &amp;&amp; curr&gt;0) returns.push((curr-prev)/prev);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!returns.length)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return { annualizedReturn:NaN, volatility:NaN, sharpe:NaN, maxDrawdown:NaN };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const avg = returns.reduce((a,b)=&gt;a+b,0)/returns.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const variance = returns.reduce((s,r)=&gt;s+(r-avg)*(r-avg),0)/returns.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const volDaily = Math.sqrt(Math.max(variance,0));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const days = 252;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const annualizedReturn = Math.pow(1+avg, days)-1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const annualizedVol = volDaily*Math.sqrt(days);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const sharpe = annualizedVol&gt;0 ? annualizedReturn/annualizedVol : NaN;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let peak = values[0], maxDD=0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>for (let i=1;i&lt;values.length;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const v=values[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (v&gt;peak) peak=v;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const dd=(v-peak)/peak;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (dd&lt;maxDD) maxDD=dd;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return { annualizedReturn, volatility:annualizedVol, sharpe, maxDrawdown:maxDD };</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Chart drawing &amp; TA ---------------------- */</span></p>
<p class="p1"><span class="s1">function drawPriceChart(canvas, series, indicators, settings) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const ctx = canvas.getContext("2d");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!ctx) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rect = canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const dpr = window.devicePixelRatio || 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const width = rect.width || 400;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const height = rect.height || 260;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>canvas.width = width*dpr; canvas.height = height*dpr;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.setTransform(dpr,0,0,dpr,0,0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.clearRect(0,0,width,height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>chartLayout = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!series || !series.length) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const chartType = settings.chartType || "line";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const showBB = settings.indicators.bb;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const showRSI = settings.indicators.rsi;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const showMACD = settings.indicators.macd;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const hasIndicatorPanel = showRSI || showMACD;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const paddingX = 28;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const topPadding = 16;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const bottomPadding = 12;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const gap = hasIndicatorPanel ? 8 : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const totalInnerH = height - topPadding - bottomPadding;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const mainRatio = hasIndicatorPanel ? 0.65 : 0.9;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const mainH = totalInnerH * mainRatio;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const indH = hasIndicatorPanel ? (totalInnerH - mainH - gap) : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const mainTop = topPadding;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const mainBottom = mainTop + mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const indTop = hasIndicatorPanel ? mainBottom + gap : null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const indBottom = hasIndicatorPanel ? indTop + indH : null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const innerW = width - paddingX*2;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const values = series.map(p=&gt;p.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let minP = Math.min(...values), maxP = Math.max(...values);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (indicators &amp;&amp; indicators.bb &amp;&amp; showBB) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const all = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>indicators.bb.upper.forEach(v=&gt;{ if(v!=null) all.push(v); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>indicators.bb.lower.forEach(v=&gt;{ if(v!=null) all.push(v); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (all.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>minP = Math.min(minP, ...all);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>maxP = Math.max(maxP, ...all);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const range = maxP-minP || 1;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const ohlc = series.map((p,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const close=p.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const prev=i&gt;0?series[i-1].value:close;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const open=prev;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const mid=(open+close)/2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const bodyRange=Math.max(Math.abs(close-open), mid*0.002);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return {open,high:mid+bodyRange*0.6,low:mid-bodyRange*0.6,close};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const points = series.map((p,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const y = mainTop + (1-(p.value-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return {x,y,value:p.value};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.strokeStyle = "rgba(30,64,175,0.4)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.lineWidth = 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.setLineDash([4,6]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.moveTo(paddingX, mainBottom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.lineTo(width-paddingX, mainBottom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.setLineDash([]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.fillStyle = "rgba(148,163,184,0.8)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.font = "10px system-ui, -apple-system, BlinkMacSystemFont, sans-serif";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.textAlign = "right"; ctx.textBaseline = "middle";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.fillText(formatCurrency(maxP), width-4, mainTop+4);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.fillText(formatCurrency(minP), width-4, mainBottom-4);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (indicators &amp;&amp; indicators.bb &amp;&amp; showBB) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const {upper,lower,middle} = indicators.bb;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const upPts=[], loPts=[], midPts=[];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>upper.forEach((v,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if(v==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const y = mainTop + (1-(v-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>upPts.push({x,y});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>lower.forEach((v,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if(v==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const y = mainTop + (1-(v-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>loPts.push({x,y});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>middle.forEach((v,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if(v==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const y = mainTop + (1-(v-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>midPts.push({x,y});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (upPts.length &amp;&amp; loPts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>upPts.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>for (let i=loPts.length-1;i&gt;=0;i--) ctx.lineTo(loPts[i].x, loPts[i].y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.closePath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.fillStyle = "rgba(56,189,248,0.08)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth=1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (upPts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>upPts.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.strokeStyle="rgba(56,189,248,0.8)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (loPts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>loPts.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.strokeStyle="rgba(56,189,248,0.8)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (midPts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>midPts.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.strokeStyle="rgba(96,165,250,0.7)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.setLineDash([3,3]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.setLineDash([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (chartType === "line") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const gradLine = ctx.createLinearGradient(paddingX, mainTop, paddingX, mainBottom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>gradLine.addColorStop(0, "rgba(56,189,248,1)");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>gradLine.addColorStop(1, "rgba(16,185,129,1)");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const gradFill = ctx.createLinearGradient(0, mainTop, 0, mainBottom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>gradFill.addColorStop(0, "rgba(45,212,191,0.20)");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>gradFill.addColorStop(1, "rgba(15,23,42,0)");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.moveTo(points[0].x, mainBottom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>points.forEach(p=&gt;ctx.lineTo(p.x,p.y));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineTo(points[points.length-1].x, mainBottom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.closePath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillStyle = gradFill; ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>points.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = gradLine;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth=2; ctx.lineJoin="round"; ctx.lineCap="round"; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const barW = Math.min(14, innerW/Math.max(series.length,1)*0.7);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const halfBar = barW/2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const wickWidth = Math.max(1, barW*0.3);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ohlc.forEach((bar,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const openY = mainTop + (1-(bar.open-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const closeY= mainTop + (1-(bar.close-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const highY = mainTop + (1-(bar.high-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const lowY<span class="Apple-converted-space">  </span>= mainTop + (1-(bar.low-minP)/range)*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const isUp = bar.close &gt;= bar.open;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const color = isUp ? "rgba(34,197,94,0.95)" : "rgba(248,113,113,0.95)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.moveTo(x, highY); ctx.lineTo(x, lowY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.strokeStyle=color; ctx.lineWidth=wickWidth; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (chartType === "candles") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const topY = Math.min(openY, closeY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const h = Math.max(1, Math.abs(closeY-openY));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.rect(x-halfBar, topY, barW, h);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle=color; ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(x-halfBar, openY); ctx.lineTo(x, openY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(x, closeY); ctx.lineTo(x+halfBar, closeY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle=color; ctx.lineWidth=1; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const draw = settings.drawing || {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const trendlines = draw.trendlines || [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const fibs = draw.fibs || [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.lineWidth=1;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>trendlines.forEach(line=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!line.p1 || !line.p2) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const x1 = paddingX + line.p1.xNorm*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const y1 = mainTop + line.p1.yNorm*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const x2 = paddingX + line.p2.xNorm*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const y2 = mainTop + line.p2.yNorm*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.moveTo(x1,y1); ctx.lineTo(x2,y2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle="rgba(248,250,252,0.85)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.setLineDash([4,2]); ctx.stroke(); ctx.setLineDash([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fibs.forEach(fib=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!fib.top || !fib.bottom) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const y1 = mainTop + fib.top.yNorm*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const y2 = mainTop + fib.bottom.yNorm*mainH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const hi = Math.min(y1,y2), lo=Math.max(y1,y2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const levels=[0,0.236,0.382,0.5,0.618,0.786,1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.font="9px system-ui,-apple-system,BlinkMacSystemFont,sans-serif";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.textAlign="left"; ctx.textBaseline="middle";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>levels.forEach(lvl=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const y = hi + (lo-hi)*lvl;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.moveTo(paddingX,y); ctx.lineTo(width-paddingX,y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.strokeStyle="rgba(250,250,250,0.35)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.setLineDash([3,3]); ctx.stroke(); ctx.setLineDash([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.fillStyle="rgba(148,163,184,0.9)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.fillText((lvl*100).toFixed(1)+"%", paddingX+2, y-1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (hasIndicatorPanel &amp;&amp; indH&gt;20 &amp;&amp; indTop!=null) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const it = indTop, ib=indBottom, ih=indH;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle="rgba(30,64,175,0.5)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth=1; ctx.setLineDash([4,6]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath(); ctx.moveTo(paddingX,ib); ctx.lineTo(width-paddingX,ib); ctx.stroke(); ctx.setLineDash([]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (showRSI &amp;&amp; indicators &amp;&amp; indicators.rsi) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const rsi = indicators.rsi;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const pts=[];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>rsi.forEach((v,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if(v==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const y = it + (1-v/100)*ih;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>pts.push({x,y});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const y70 = it + (1-70/100)*ih;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const y30 = it + (1-30/100)*ih;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.fillStyle="rgba(15,23,42,0.8)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.fillRect(paddingX,y70,innerW,y30-y70);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.beginPath(); ctx.moveTo(paddingX,y70); ctx.lineTo(width-paddingX,y70);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.moveTo(paddingX,y30); ctx.lineTo(width-paddingX,y30);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.strokeStyle="rgba(148,163,184,0.6)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx.setLineDash([2,3]); ctx.stroke(); ctx.setLineDash([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (pts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>pts.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle="rgba(244,114,182,0.9)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineWidth=1.3; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (showMACD &amp;&amp; indicators &amp;&amp; indicators.macd) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const {macd,signal,hist} = indicators.macd;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const macdVals=[], histVals=[];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>macd.forEach(v=&gt;{ if(v!=null) macdVals.push(v); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>hist.forEach(v=&gt;{ if(v!=null) histVals.push(v); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (macdVals.length &amp;&amp; histVals.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const minM = Math.min(...macdVals,...histVals);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const maxM = Math.max(...macdVals,...histVals);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const rangeM = maxM-minM || 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>for (let i=0;i&lt;hist.length;i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const v = hist[i]; if(v==null) continue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const y0 = it + (1-(-minM/rangeM))*ih;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const yv = it + (1-(v-minM)/rangeM)*ih;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.beginPath(); ctx.moveTo(x,y0); ctx.lineTo(x,yv);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.strokeStyle = v&gt;=0 ? "rgba(34,197,94,0.8)" : "rgba(248,113,113,0.8)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.lineWidth=2; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const macdPts=[], sigPts=[];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>macd.forEach((v,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>if(v==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const y = it + (1-(v-minM)/rangeM)*ih;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>macdPts.push({x,y});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>signal.forEach((v,i)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>if(v==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const x = paddingX + (i/Math.max(series.length-1,1))*innerW;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const y = it + (1-(v-minM)/rangeM)*ih;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>sigPts.push({x,y});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (macdPts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>macdPts.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.strokeStyle="rgba(56,189,248,0.9)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.lineWidth=1.4; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (sigPts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>sigPts.forEach((p,i)=&gt;{ if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.strokeStyle="rgba(148,163,184,0.9)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>ctx.lineWidth=1; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillStyle="rgba(148,163,184,0.9)";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.font="9px system-ui,-apple-system,BlinkMacSystemFont,sans-serif";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.textAlign="left"; ctx.textBaseline="top";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const tags=[];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (showRSI) tags.push("RSI(14)");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (showMACD) tags.push("MACD(12,26,9)");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillText(tags.join(" · "), paddingX, indTop+2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>chartLayout = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>width, height,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>paddingX,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>mainTop, mainHeight: mainH, mainBottom,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>innerWidth: innerW</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function computeIndexReturnsFromDaily(closes) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!closes || closes.length &lt; 30) return { month: NaN, quarter: NaN, year: NaN };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const lastIdx = closes.length - 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const idx1M = Math.max(0, lastIdx - 22);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const idx3M = Math.max(0, lastIdx - 66);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const idx1Y = Math.max(0, lastIdx - 252);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const last<span class="Apple-converted-space">  </span>= closes[lastIdx];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const p1M <span class="Apple-converted-space">  </span>= closes[idx1M];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const p3M <span class="Apple-converted-space">  </span>= closes[idx3M];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const p1Y <span class="Apple-converted-space">  </span>= closes[idx1Y];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>function ret(past) { if (!past || !last) return NaN; return last / past - 1; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return { month: ret(p1M), quarter: ret(p3M), year: ret(p1Y) };</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function fetchIndexDailyAlphaVantage(symbol, apiKey) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&amp;symbol=${encodeURIComponent(symbol)}&amp;outputsize=compact&amp;apikey=${encodeURIComponent(apiKey)}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const res = await fetch(url);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!res.ok) throw new Error(`Alpha Vantage error ${res.status}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const json = await res.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const series = json["Time Series (Daily)"];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!series) throw new Error("Unexpected Alpha Vantage payload");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const dates = Object.keys(series).map(d =&gt; new Date(d)).sort((a, b) =&gt; a - b);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return dates.map(d =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const key = d.toISOString().slice(0, 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return parseFloat(series[key]["4. close"]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}).filter(v =&gt; isFinite(v));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function fetchBenchmarks() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Cached logic to prevent 429s</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const cached = loadJson(STORAGE_KEYS.benchmarks, null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const now = Date.now();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (cached &amp;&amp; (now - cached.timestamp &lt; 12 * 60 * 60 * 1000)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>BENCHMARK_RETURNS.month = cached.month;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>BENCHMARK_RETURNS.quarter = cached.quarter;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>BENCHMARK_RETURNS.year = cached.year;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>BENCHMARK_RETURNS.hasLive = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const data = state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderBenchmarksAndScenario(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const API_KEY = "14FXYP264JB2XC5F";<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const spyCloses = await fetchIndexDailyAlphaVantage("SPY", API_KEY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>await new Promise(r =&gt; setTimeout(r, 1500)); // Rate limit niceness</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const qqqCloses = await fetchIndexDailyAlphaVantage("QQQ", API_KEY);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const spRet<span class="Apple-converted-space">  </span>= computeIndexReturnsFromDaily(spyCloses);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ndqRet = computeIndexReturnsFromDaily(qqqCloses);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const newData = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>timestamp: now,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>month: { sp: spRet.month, nasdaq: ndqRet.month },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>quarter: { sp: spRet.quarter, nasdaq: ndqRet.quarter },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>year: { sp: spRet.year, nasdaq: ndqRet.year }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!isNaN(spRet.month)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>BENCHMARK_RETURNS.month = newData.month;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>BENCHMARK_RETURNS.quarter = newData.quarter;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>BENCHMARK_RETURNS.year = newData.year;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>BENCHMARK_RETURNS.hasLive = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>saveJson(STORAGE_KEYS.benchmarks, newData);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">      </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const data = state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>renderBenchmarksAndScenario(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} catch (err) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>console.warn("Benchmarks unavailable (rate limit or network), using defaults.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Silent fallback</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Sentiment ---------------------- */</span></p>
<p class="p1"><span class="s1">async function fetchSentiment() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const fngRes = await fetch("https://api.alternative.me/fng/?limit=1");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (fngRes.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const json = await fngRes.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const data = json.data[0];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.fngValue) el.fngValue.textContent = data.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.fngLabel) el.fngLabel.textContent = data.value_classification;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.fngBar) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.fngBar.style.width = data.value + "%";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.fngBar.className = `h-full transition-all duration-500 ${</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>data.value &lt; 25 ? "bg-rose-500" : data.value &lt; 50 ? "bg-orange-400" : data.value &lt; 75 ? "bg-emerald-400" : "bg-emerald-500"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const globRes = await fetch("https://api.coingecko.com/api/v3/global");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (globRes.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const json = await globRes.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const btc = json.data.market_cap_percentage.btc;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const eth = json.data.market_cap_percentage.eth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const mcap = json.data.total_market_cap.usd;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">      </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.btcDom) el.btcDom.textContent = btc.toFixed(1) + "%";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.globalMcap) el.globalMcap.textContent = "$" + (mcap / 1e12).toFixed(2) + "T";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.altMcap) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>const altShare = 100 - btc - (eth || 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>const altVal = mcap * (altShare / 100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>el.altMcap.textContent = "$" + (altVal / 1e12).toFixed(2) + "T";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">      </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.altSeason) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const altIndex = Math.max(0, Math.min(100, (60 - btc) * 3.5));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.altSeason.textContent = altIndex.toFixed(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.altSeason.classList.remove("text-emerald-400", "font-bold", "text-slate-200");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.altSeason.classList.add("font-mono");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (altIndex &gt; 75) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>el.altSeason.classList.add("text-emerald-400", "font-bold");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>el.altSeason.classList.add("text-slate-200");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} catch (e) { console.log("Sentiment fetch failed", e); }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Backtesting ---------------------- */</span></p>
<p class="p1"><span class="s1">function runBacktest() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!el.btResults || !state.lastPortfolioData) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.btResults.classList.remove("hidden");</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const strategy = el.btStrategy.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const days = parseInt(el.btPeriod.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const portfolio = state.lastPortfolioData;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const startValue = 10000;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const dailyVol = 0.035;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const drift = 0.0005;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const pricePath = [startValue];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>for (let i=1; i&lt;=days; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const change = (Math.random() + Math.random() + Math.random() - 1.5) * dailyVol + drift;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>pricePath.push(pricePath[i-1] * (1 + change));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const equityCurve = [startValue];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let cash = startValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let invested = 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>function calcSMA(arr, period, idx) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (idx &lt; period) return null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let sum=0; for(let k=0; k&lt;period; k++) sum+=arr[idx-k];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return sum/period;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>for (let i=0; i&lt;pricePath.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const price = pricePath[i];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const fast = calcSMA(pricePath, 20, i);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const slow = calcSMA(pricePath, 50, i);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let rsiVal = 50;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (i &gt; 14) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>let gains=0, losses=0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>for(let k=0; k&lt;14; k++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>const d = pricePath[i-k] - pricePath[i-k-1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>if (d&gt;0) gains+=d; else if (d&lt;0) losses-=d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>if (losses === 0) rsiVal = 100;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>else rsiVal = 100 - 100/(1+(gains/losses));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let action = "hold";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (strategy === "hold") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (i===0) action = "buy";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (strategy === "sma_cross") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (fast &amp;&amp; slow) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (fast &gt; slow &amp;&amp; invested === 0) action = "buy";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (fast &lt; slow &amp;&amp; invested &gt; 0) action = "sell";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (strategy === "rsi_strat") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (rsiVal &lt; 30 &amp;&amp; invested === 0) action = "buy";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (rsiVal &gt; 70 &amp;&amp; invested &gt; 0) action = "sell";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (strategy === "bollinger") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (fast) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>if (price &gt; fast*1.05 &amp;&amp; invested === 0) action = "buy";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>if (price &lt; fast*0.95 &amp;&amp; invested &gt; 0) action = "sell";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (action === "buy") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>invested = cash / price;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>cash = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (action === "sell") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>cash = invested * price;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>invested = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const curVal = cash + (invested * price);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>equityCurve.push(curVal);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const returns = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let peak = equityCurve[0];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let maxDD = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let downsideSum = 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>for(let i=1; i&lt;equityCurve.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const r = (equityCurve[i] - equityCurve[i-1]) / equityCurve[i-1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>returns.push(r);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (equityCurve[i] &gt; peak) peak = equityCurve[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const dd = (peak - equityCurve[i]) / peak;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (dd &gt; maxDD) maxDD = dd;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (r &lt; 0) downsideSum += r*r;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const avgRet = returns.reduce((a,b)=&gt;a+b,0)/returns.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const stdDev = Math.sqrt(returns.reduce((s,r)=&gt;s+(r-avgRet)**2, 0)/returns.length);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const downDev = Math.sqrt(downsideSum / returns.length);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const annRet = avgRet * 365;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const annVol = stdDev * Math.sqrt(365);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const riskFree = 0.02;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const sharpe = annVol &gt; 0 ? (annRet - riskFree) / annVol : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const sortino = downDev &gt; 0 ? (annRet - riskFree) / (downDev * Math.sqrt(365)) : 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.btSharpe) el.btSharpe.textContent = sharpe.toFixed(2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.btSortino) el.btSortino.textContent = sortino.toFixed(2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.btMaxDD) el.btMaxDD.textContent = "-" + (maxDD*100).toFixed(1) + "%";</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.btSharpe, sharpe);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.btSortino, sortino);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>drawBacktestChart(el.btChart, pricePath, equityCurve);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawBacktestChart(canvas, buyHold, strategy) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const ctx = canvas.getContext("2d");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!ctx) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const dpr = window.devicePixelRatio || 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rect = canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>canvas.width = rect.width * dpr;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>canvas.height = rect.height * dpr;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.setTransform(dpr, 0, 0, dpr, 0, 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>ctx.clearRect(0, 0, rect.width, rect.height);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const pad = 4;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const w = rect.width - pad*2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const h = rect.height - pad*2;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const all = [...buyHold, ...strategy];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const min = Math.min(...all);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const max = Math.max(...all);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const range = max - min || 1;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>function plot(data, color, dash=[]) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth = 1.5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.setLineDash(dash);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>data.forEach((v, i) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const x = pad + (i / (data.length - 1)) * w;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const y = pad + h - ((v - min) / range) * h;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.setLineDash([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>plot(buyHold, "rgba(148,163,184,0.5)", [3,3]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>plot(strategy, "rgba(129,140,248,1)");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Price fetching ---------------------- */</span></p>
<p class="p1"><span class="s1">async function refreshPrices(opts={light:false}) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.refreshBtn) el.refreshBtn.disabled=true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.priceStatus) el.priceStatus.textContent="Refreshing…";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.refreshDot) el.refreshDot.classList.add("bg-emerald-300","animate-pulse");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const idsSet = new Set();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.portfolio.forEach(h=&gt;idsSet.add(h.id));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.watchlist.forEach(id=&gt;idsSet.add(id));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.alerts.forEach(a=&gt;idsSet.add(a.coinId));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ids = Array.from(idsSet).filter(Boolean);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!ids.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>state.priceData = {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const now = new Date();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.lastUpdated) el.lastUpdated.textContent = now.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (el.priceStatus) el.priceStatus.textContent="No assets";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const data = calculatePortfolio(state.portfolio, state.priceData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>state.lastPortfolioData = data;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const vsCurrencies = Object.keys(CURRENCY_CONFIG).join(",");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const url = `https://api.coingecko.com/api/v3/simple/price?vs_currencies=${vsCurrencies}&amp;include_24hr_change=true&amp;ids=`+ids.map(encodeURIComponent).join(",");</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const res = await fetch(url);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!res.ok) throw new Error("Price error "+res.status);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const data = await res.json();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (data.tether) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const t = data.tether;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const usdVal = t.usd || 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>Object.keys(CURRENCY_CONFIG).forEach(k =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>if (t[k]) state.fxRates[k] = t[k] / usdVal;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Save FX to local storage so it doesn't reset on reload</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>saveJson(STORAGE_KEYS.fx, state.fxRates);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.priceData = data || {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const now = new Date();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.lastUpdated) el.lastUpdated.textContent = now.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.priceStatus) el.priceStatus.textContent="Live prices";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const portfolioData = calculatePortfolio(state.portfolio,state.priceData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.lastPortfolioData=portfolioData;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>checkAlerts();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} catch (err) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>console.warn(err);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.priceStatus) el.priceStatus.textContent="Price error";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Could not refresh prices. Try again shortly.","error");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} finally {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.refreshBtn) el.refreshBtn.disabled=false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.refreshDot) el.refreshDot.classList.remove("animate-pulse");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Rendering helpers ---------------------- */</span></p>
<p class="p1"><span class="s1">function renderSummary(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!data || !data.totals) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const { totals, best, worst } = data;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.totalValue.textContent = formatCurrency(totals.totalValue);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.totalCost.textContent = formatCurrency(totals.totalCost);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.totalPnl.textContent = formatCurrency(totals.totalPnlAbs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.totalPnlPct.textContent = totals.totalPnlPct ? formatPercent(totals.totalPnlPct) : "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.totalPnl, totals.totalPnlAbs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.totalPnlPct, totals.totalPnlPct);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetsCount.textContent = data.holdings.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.dayPnl.textContent = formatCurrency(totals.dayChangeAbs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.dayPnlPct.textContent = formatPercent(totals.dayChangePct);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.dayPnl, totals.dayChangeAbs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.dayPnlPct, totals.dayChangePct);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.bestName.textContent = best ? `${best.symbol} · ${best.name}` : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.bestChange.textContent = best ? formatPercent(best.change24hPct) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.worstName.textContent = worst ? `${worst.symbol} · ${worst.name}` : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.worstChange.textContent = worst ? formatPercent(worst.change24hPct) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.bestChange, best ? best.change24hPct : 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.worstChange, worst ? worst.change24hPct : 0);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderHoldings(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const holdings = data.holdings || [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.holdingsBody.innerHTML = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!holdings.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.noHoldings.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.noHoldings.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>holdings.forEach(h =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const tr = document.createElement("tr");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>tr.className = "bg-slate-900/40 hover:bg-slate-900/80 transition rounded-xl";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>tr.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;td class="px-3 py-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span class="font-semibold"&gt;${h.symbol}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;span class="text-[11px] text-slate-400"&gt;${h.name}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;td class="px-3 py-2 text-right font-mono"&gt;${h.amount.toFixed(6).replace(/\.0+$/, "")}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;td class="px-3 py-2 text-right font-mono"&gt;${formatCurrency(h.price)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;td class="px-3 py-2 text-right font-mono"&gt;${formatCurrency(h.value)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;td class="px-3 py-2 text-right font-mono ${h.pnlAbs&gt;=0?"text-emerald-400":"text-rose-400"}"&gt;${formatCurrency(h.pnlAbs)}&lt;br&gt;&lt;span class="text-[11px] text-slate-400"&gt;${formatPercent(h.pnlPct)}&lt;/span&gt;&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;td class="px-3 py-2 text-right font-mono"&gt;${formatPercent(h.allocationPct)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;td class="px-3 py-2 text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="inline-flex gap-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;button data-action="edit" data-id="${h.id}" class="px-2 py-1 text-[11px] rounded-full border border-slate-700 text-slate-200 hover:border-emerald-400"&gt;Edit&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;button data-action="delete" data-id="${h.id}" class="px-2 py-1 text-[11px] rounded-full border border-slate-700 text-slate-300 hover:border-rose-400"&gt;Remove&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/td&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.holdingsBody.appendChild(tr);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderAllocationMini(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const holdings = data.holdings || [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.allocationList.innerHTML = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!holdings.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.allocationEmpty.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.allocationEmpty.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>holdings.forEach(h =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const row = document.createElement("div");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>row.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="flex items-center justify-between text-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;span class="font-semibold"&gt;${h.symbol}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;span class="font-mono text-slate-300"&gt;${formatPercent(h.allocationPct)}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="mt-1 h-2 rounded-full bg-slate-800 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="h-full rounded-full ${h.pnlAbs&gt;=0?"bg-emerald-400":"bg-rose-400"}" style="width:${Math.min(100,h.allocationPct)}%"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.allocationList.appendChild(row);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderWatchlist() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.watchlistList.innerHTML = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!state.watchlist.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.watchlistEmpty.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.watchlistEmpty.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.watchlist.forEach(id =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const meta = findCoinMeta(id) || { symbol: id.toUpperCase(), name: id };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const price = getDisplayPrice(id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const change = getDisplayChange(id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const li = document.createElement("li");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>li.className = "rounded-xl border border-slate-800 bg-slate-900/50 px-3 py-2 flex items-center justify-between gap-3";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>li.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="font-semibold"&gt;${meta.symbol}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="text-[11px] text-slate-500"&gt;${meta.name}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="font-mono"&gt;${price!=null?formatCurrency(price):"--"}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="text-[11px] ${change&gt;=0?"text-emerald-400":"text-rose-400"}"&gt;${change!=null?formatPercent(change):"--"}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;button data-id="${id}" class="watchlist-remove text-[11px] text-slate-400 hover:text-rose-400"&gt;Remove&lt;/button&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.watchlistList.appendChild(li);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderChartSection(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const totals = data?.totals || {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const series = totals.totalValue ? ensureChartSeries(state.timeframe, totals.totalValue) : [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const indicators = computeIndicators(series);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!series.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.chartEmpty) el.chartEmpty.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.chartCanvas) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const ctx = el.chartCanvas.getContext("2d");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>ctx &amp;&amp; ctx.clearRect(0,0,el.chartCanvas.width, el.chartCanvas.height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.chartEmpty.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>drawPriceChart(el.chartCanvas, series, indicators, state.chartSettings);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>document.querySelectorAll(".timeframe-btn").forEach(btn =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (btn.dataset.timeframe === state.timeframe) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>btn.classList.add("bg-slate-800","text-slate-100","shadow-[0_0_0_1px_rgba(148,163,184,0.55)]");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>btn.classList.remove("bg-slate-800","text-slate-100","shadow-[0_0_0_1px_rgba(148,163,184,0.55)]");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>btn.classList.add("text-slate-400");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>document.querySelectorAll(".chart-type-btn").forEach(btn =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (btn.dataset.chartType === state.chartSettings.chartType) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>btn.classList.add("bg-slate-800","text-slate-100","shadow-[0_0_0_1px_rgba(148,163,184,0.55)]");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>btn.classList.remove("bg-slate-800","text-slate-100","shadow-[0_0_0_1px_rgba(148,163,184,0.55)]");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>btn.classList.add("text-slate-400");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderRiskMetrics(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const totals = data?.totals || {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const baseSeries = totals.totalValue ? ensureChartSeries("30d", totals.totalValue) : [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const metrics = computeSeriesMetrics(baseSeries);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.metricAnnualized.textContent = isFinite(metrics.annualizedReturn) ? formatPercent(metrics.annualizedReturn*100) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.metricVolatility.textContent = isFinite(metrics.volatility) ? formatPercent(metrics.volatility*100) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.metricSharpe.textContent = isFinite(metrics.sharpe) ? metrics.sharpe.toFixed(2) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.metricMaxDD.textContent = isFinite(metrics.maxDrawdown) ? formatPercent(metrics.maxDrawdown*100) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.metricSharpe, metrics.sharpe);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const dailyVol = isFinite(metrics.volatility) ? metrics.volatility / Math.sqrt(252) : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const oneDayVar = totals.totalValue * dailyVol * 1.65;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const fiveDayVar = totals.totalValue * dailyVol * Math.sqrt(5) * 1.65;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.metricVaR1d.textContent = totals.totalValue ? `-${formatCurrency(Math.abs(oneDayVar))}` : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.metricVaR1dPct.textContent = totals.totalValue ? `-${formatPercent(dailyVol*1.65*100)}` : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.metricVaR5d.textContent = totals.totalValue ? `-${formatCurrency(Math.abs(fiveDayVar))}` : "--";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateStressSummary(data, parseFloat(el.riskStressSelect.value || "-0.25"));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (data.holdings.length &lt; 2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.riskCorrGrid.innerHTML = '&lt;p class="text-[10px] text-slate-500"&gt;Add at least two assets to see simulated correlations.&lt;/p&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const top = data.holdings.slice(0,4);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const header = ['&lt;div class="grid" style="grid-template-columns: repeat('+(top.length+1)+', minmax(0,1fr)); gap:4px; font-size:10px;"&gt;'];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>header.push('&lt;div&gt;&lt;/div&gt;');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>top.forEach(h =&gt; header.push(`&lt;div class="text-center text-slate-400"&gt;${h.symbol}&lt;/div&gt;`));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>top.forEach(a =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>header.push(`&lt;div class="text-slate-400"&gt;${a.symbol}&lt;/div&gt;`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>top.forEach(b =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const val = a.id === b.id ? 1 : pseudoCorrelation(a.id, b.id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const pct = formatPercent(val*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>header.push(`&lt;div class="text-center font-mono ${val&gt;=0?"text-emerald-300":"text-rose-300"}"&gt;${pct}&lt;/div&gt;`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>header.push('&lt;/div&gt;');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.riskCorrGrid.innerHTML = header.join("");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderBenchmarksAndScenario(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const totals = data?.totals || {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const monthSeries = totals.totalValue ? ensureChartSeries("30d", totals.totalValue) : [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let monthRet = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (monthSeries.length &gt;= 2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const first = monthSeries[0].value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const last = monthSeries[monthSeries.length-1].value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (first &gt; 0) monthRet = (last - first) / first;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const quarterRet = monthRet * 3;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const yearRet = monthRet * 12;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfMonthPortfolio.textContent = totals.totalValue ? formatPercent(monthRet*100) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfQuarterPortfolio.textContent = totals.totalValue ? formatPercent(quarterRet*100) : "--";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfYearPortfolio.textContent = totals.totalValue ? formatPercent(yearRet*100) : "--";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfMonthSP.textContent = formatPercent(BENCHMARK_RETURNS.month.sp*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfQuarterSP.textContent = formatPercent(BENCHMARK_RETURNS.quarter.sp*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfYearSP.textContent = formatPercent(BENCHMARK_RETURNS.year.sp*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfMonthNasdaq.textContent = formatPercent(BENCHMARK_RETURNS.month.nasdaq*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfQuarterNasdaq.textContent = formatPercent(BENCHMARK_RETURNS.quarter.nasdaq*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.perfYearNasdaq.textContent = formatPercent(BENCHMARK_RETURNS.year.nasdaq*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!BENCHMARK_RETURNS.hasLive) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.perfMonthSP.classList.add("text-slate-400");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.perfMonthNasdaq.classList.add("text-slate-400");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderAlerts() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.alertsList.innerHTML = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!state.alerts.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.alertsEmpty.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.alertsEmpty.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.alerts.forEach(alert =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const li = document.createElement("li");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>li.className = "rounded-xl border border-slate-800 bg-slate-900/40 px-3 py-2 flex items-center justify-between gap-3";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>li.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="font-semibold text-sm"&gt;${alert.symbol || alert.coinId}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="text-[11px] text-slate-500"&gt;${alert.direction === "above" ? "≥" : "≤"} ${formatCurrency(alert.target)}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button data-action="toggle" data-id="${alert.id}" class="text-[11px] ${alert.active?"text-emerald-400":"text-slate-500"}"&gt;${alert.active?"Active":"Paused"}&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button data-action="delete" data-id="${alert.id}" class="text-[11px] text-slate-400 hover:text-rose-400"&gt;Remove&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.alertsList.appendChild(li);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderNews(isFallback = false) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const news = state.news || [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const filter = state.newsFilter;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!news.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.newsEmpty.textContent = isFallback ? "News unavailable right now." : "Loading news…";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.newsEmpty.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const filtered = filter === "all" ? news : news.filter(item =&gt; item.coins.some(c =&gt; c === filter || c === filter.toUpperCase()));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.newsStrip.innerHTML = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!filtered.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.newsEmpty.textContent = "No stories for that filter.";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.newsEmpty.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.newsEmpty.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>filtered.forEach(item =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const card = document.createElement("article");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>card.className = "min-w-[240px] snap-start rounded-2xl border border-slate-800 bg-slate-900/40 p-3 flex flex-col gap-2";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>card.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="flex items-center justify-between text-[10px] text-slate-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;span&gt;${item.source}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;span&gt;${humanizeTimeAgo(item.publishedAt)}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;a href="${item.url}" target="_blank" rel="noopener" class="text-sm font-semibold text-slate-100 line-clamp-3 hover:text-emerald-300"&gt;${item.title}&lt;/a&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;p class="text-[11px] text-slate-500 line-clamp-2"&gt;${item.summary}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="flex flex-wrap gap-1 text-[10px] text-slate-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>${item.coins.slice(0,3).map(tag =&gt; `&lt;span class="px-1.5 py-0.5 rounded-full bg-slate-800/70"&gt;${tag}&lt;/span&gt;`).join("")}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.newsStrip.appendChild(card);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>startNewsAutoScroll();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Event handlers ---------------------- */</span></p>
<p class="p1"><span class="s1">function populateSelects(searchTerm = "") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const term = searchTerm.trim().toLowerCase();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let list = COINS;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (term) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>list = COINS.filter(c =&gt; c.name.toLowerCase().includes(term) || c.symbol.toLowerCase().includes(term));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const assetOptions = list.slice(0, 150);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const current = el.assetSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetSelect.innerHTML = assetOptions.map(c =&gt; `&lt;option value="${c.id}"&gt;${c.symbol} · ${c.name}&lt;/option&gt;`).join("");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (current &amp;&amp; assetOptions.every(o =&gt; o.id !== current)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const existing = findCoinMeta(current);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (existing) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const opt = document.createElement("option");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>opt.value = existing.id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>opt.textContent = `${existing.symbol} · ${existing.name}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>el.assetSelect.prepend(opt);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (current) el.assetSelect.value = current;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.watchlistSelect.innerHTML = COINS.slice(0, 200).map(c =&gt; `&lt;option value="${c.id}"&gt;${c.symbol} · ${c.name}&lt;/option&gt;`).join("");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.alertsAsset.innerHTML = COINS.map(c =&gt; `&lt;option value="${c.id}"&gt;${c.symbol} · ${c.name}&lt;/option&gt;`).join("");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const filterSet = new Set(["all", ...state.portfolio.map(h =&gt; h.id), ...state.watchlist]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.newsCoinFilter.innerHTML = Array.from(filterSet).map(id =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (id === "all") return '&lt;option value="all"&gt;All&lt;/option&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const meta = findCoinMeta(id) || { symbol: id.toUpperCase(), name: id };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return `&lt;option value="${id}"&gt;${meta.symbol}&lt;/option&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}).join("");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.newsCoinFilter.value = filterSet.has(state.newsFilter) ? state.newsFilter : "all";</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleTimeframeClick(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const timeframe = e.currentTarget.dataset.timeframe;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!timeframe || timeframe === state.timeframe) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.timeframe = timeframe;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderChartSection(state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleChartTypeClick(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const chartType = e.currentTarget.dataset.chartType;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!chartType || chartType === state.chartSettings.chartType) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.chartType = chartType;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderChartSection(state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleAssetForm(event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>event.preventDefault();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const coinId = el.assetSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const amount = parseFloat(el.assetAmount.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!coinId || !isFinite(amount) || amount &lt;= 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetFormError.textContent = "Select an asset and enter a valid amount.";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetFormError.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetFormError.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const buyPriceInput = parseFloat(el.assetBuyPrice.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const entryCur = el.assetEntryCurrency.value || "usd";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const fx = state.fxRates[entryCur] || 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const buyPriceUsd = isFinite(buyPriceInput) &amp;&amp; buyPriceInput &gt; 0 ? buyPriceInput / fx : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const meta = findCoinMeta(coinId) || { id: coinId, symbol: coinId.toUpperCase(), name: coinId };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const existingIndex = state.portfolio.findIndex(h =&gt; h.id === coinId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (editingCoinId &amp;&amp; existingIndex &gt;= 0 &amp;&amp; editingCoinId !== coinId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Cannot change to a new asset while editing. Remove and add again.", "warn");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (editingCoinId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const idx = state.portfolio.findIndex(h =&gt; h.id === editingCoinId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (idx &gt;= 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>state.portfolio[idx].amount = amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>state.portfolio[idx].buyPrice = buyPriceUsd;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Position updated", "success");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else if (existingIndex &gt;= 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const holding = state.portfolio[existingIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const totalAmount = holding.amount + amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const newCost = (holding.buyPrice * holding.amount + (buyPriceUsd || holding.buyPrice) * amount) / totalAmount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>holding.amount = totalAmount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>holding.buyPrice = newCost || holding.buyPrice;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Position topped up", "success");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.portfolio.push({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>id: meta.id,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>symbol: meta.symbol,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>name: meta.name,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>amount,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>buyPrice: buyPriceUsd</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Position added", "success");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>persistPortfolio();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>clearEditMode();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetForm.reset();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>refreshPrices({ light: true });</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function clearEditMode() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>editingCoinId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetForm.reset();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetSearch.value = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetFormTitle.textContent = "Add position";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetSubmitLabel.textContent = "Add position";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.assetCancelEdit.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>populateSelects();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleHoldingsClick(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const btn = e.target.closest("button[data-action]");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!btn) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const id = btn.dataset.id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const action = btn.dataset.action;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!id) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const holding = state.portfolio.find(h =&gt; h.id === id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!holding) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (action === "edit") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>editingCoinId = id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>populateSelects();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetSelect.value = id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetAmount.value = holding.amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetBuyPrice.value = holding.buyPrice ? holding.buyPrice : "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetFormTitle.textContent = `Editing ${holding.symbol}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetSubmitLabel.textContent = "Update position";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetCancelEdit.classList.remove("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.assetFormError.classList.add("hidden");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else if (action === "delete") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.portfolio = state.portfolio.filter(h =&gt; h.id !== id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>persistPortfolio();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast(`${holding.symbol} removed`, "warn");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>clearEditMode();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleWatchlistForm(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>e.preventDefault();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const id = el.watchlistSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!id) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (state.watchlist.includes(id)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Already on watchlist", "info");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.watchlist.push(id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>persistWatchlist();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderWatchlist();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>populateSelects(el.assetSearch.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>showToast("Watchlist updated", "success");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleWatchlistClick(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const btn = e.target.closest("button.watchlist-remove");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!btn) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const id = btn.dataset.id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.watchlist = state.watchlist.filter(item =&gt; item !== id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>persistWatchlist();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderWatchlist();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>populateSelects(el.assetSearch.value);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleAlertsForm(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>e.preventDefault();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const coinId = el.alertsAsset.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const direction = el.alertsDirection.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const target = parseFloat(el.alertsPrice.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!coinId || !isFinite(target) || target &lt;= 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Enter a valid alert target", "error");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const meta = findCoinMeta(coinId) || { symbol: coinId.toUpperCase(), name: coinId };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.alerts.push({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>id: String(Date.now()),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>coinId,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>symbol: meta.symbol,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>name: meta.name,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>direction,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>target,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>repeat: el.alertsRepeat.checked,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>active: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>lastTriggered: null</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>persistAlerts();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.alertsForm.reset();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderAlerts();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>showToast("Alert added", "success");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleAlertsListClick(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const btn = e.target.closest("button[data-action]");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!btn) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const id = btn.dataset.id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const alert = state.alerts.find(a =&gt; a.id === id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!alert) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (btn.dataset.action === "toggle") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>alert.active = !alert.active;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast(`Alert ${alert.active?"resumed":"paused"}`, "info");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else if (btn.dataset.action === "delete") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.alerts = state.alerts.filter(a =&gt; a.id !== id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Alert deleted", "warn");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>persistAlerts();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderAlerts();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleNewsFilter(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.newsFilter = e.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderNews();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleIndicatorToggle() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.indicators.bb = el.indicatorBB.checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.indicators.rsi = el.indicatorRSI.checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.indicators.macd = el.indicatorMACD.checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderChartSection(state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleDrawToolChange(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.drawing.tool = e.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.drawing.pending = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>showToast(state.chartSettings.drawing.tool === "none" ? "Drawing disabled" : `Drawing ${state.chartSettings.drawing.tool}`, "info");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleDrawClear() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.drawing.trendlines = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.drawing.fibs = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.drawing.pending = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderChartSection(state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>showToast("Drawing overlays cleared", "success");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleChartClick(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const tool = state.chartSettings.drawing.tool;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (tool === "none" || !chartLayout) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rect = el.chartCanvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const xNorm = clamp((e.clientX - rect.left - chartLayout.paddingX) / chartLayout.innerWidth);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const yNorm = clamp((e.clientY - rect.top - chartLayout.mainTop) / chartLayout.mainHeight);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!state.chartSettings.drawing.pending) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.chartSettings.drawing.pending = { type: tool, first: { xNorm, yNorm } };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("First point locked. Click again to finish.", "info");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const pending = state.chartSettings.drawing.pending;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (pending.type !== tool) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.chartSettings.drawing.pending = { type: tool, first: { xNorm, yNorm } };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (tool === "trendline") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.chartSettings.drawing.trendlines.push({ p1: pending.first, p2: { xNorm, yNorm } });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} else if (tool === "fib") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.chartSettings.drawing.fibs.push({ top: pending.first, bottom: { xNorm, yNorm } });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.chartSettings.drawing.pending = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderChartSection(state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleScenarioSubmit(e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>e.preventDefault();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const base = state.lastPortfolioData?.totals?.totalValue || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!base) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("Add holdings to run scenarios.", "warn");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const extra = parseFloat(el.scenarioAmount.value) || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const move = parseFloat(el.scenarioMove.value) || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const future = (base + extra) * (1 + move);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const pnl = future - base;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.scenarioResultValue.textContent = formatCurrency(future);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.scenarioResultPnl.textContent = formatCurrency(pnl);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.scenarioResultPnl, pnl);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.scenarioNote.textContent = `Shock ${formatPercent(move*100)} applied to current holdings plus extra capital.`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateStressSummary(data, shock) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!data || !data.totals || !data.totals.totalValue) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>el.riskStressSummary.textContent = "Add holdings to see crash impact.";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const base = data.totals.totalValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const future = base * (1 + shock);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const delta = future - base;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.riskStressLabel.textContent = formatPercent(shock*100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.riskStressSummary.textContent = `${formatCurrency(future)} (${delta&gt;=0?"+":""}${formatCurrency(delta).replace("$","$")})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>updateTrendClass(el.riskStressSummary, delta);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function checkAlerts() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!state.alerts.length) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let triggered = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.alerts.forEach(alert =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!alert.active) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const price = getDisplayPrice(alert.coinId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (price == null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (alert.direction === "above" &amp;&amp; price &gt;= alert.target) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>triggered = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>alert.lastTriggered = Date.now();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!alert.repeat) alert.active = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>showToast(`${alert.symbol} hit ≥ ${formatCurrency(alert.target)}`, "success");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>playAlertTone();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (alert.direction === "below" &amp;&amp; price &lt;= alert.target) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>triggered = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>alert.lastTriggered = Date.now();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!alert.repeat) alert.active = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>showToast(`${alert.symbol} hit ≤ ${formatCurrency(alert.target)}`, "warn");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>playAlertTone();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (triggered) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>persistAlerts();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderAlerts();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function showToast(message, type = "info") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!el.toastContainer) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const toast = document.createElement("div");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const colors = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>success: "bg-emerald-500/20 border-emerald-400 text-emerald-100",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>error: "bg-rose-500/20 border-rose-400 text-rose-100",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>warn: "bg-amber-500/20 border-amber-400 text-amber-100",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>info: "bg-slate-800/80 border-slate-600 text-slate-100"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>toast.className = `px-3 py-2 rounded-xl border text-sm shadow-lg ${colors[type] || colors.info}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>toast.textContent = message;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.toastContainer.appendChild(toast);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>toast.classList.add("opacity-0", "translate-y-2", "transition-all");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setTimeout(() =&gt; toast.remove(), 300);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}, 3500);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function unlockAudio() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!audioCtx) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>audioCtx = new (window.AudioContext || window.webkitAudioContext)();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (audioCtx.state === 'suspended') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>audioCtx.resume();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function ensureAudioContext() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return audioCtx;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function playAlertTone() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const ctx = ensureAudioContext();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!ctx) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const osc = ctx.createOscillator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const gain = ctx.createGain();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>osc.frequency.value = 880;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>gain.gain.setValueAtTime(0.001, ctx.currentTime);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>gain.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.01);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.4);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>osc.connect(gain).connect(ctx.destination);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>osc.start();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>osc.stop(ctx.currentTime + 0.4);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function startNewsAutoScroll() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (state.newsAutoScrollTimer) clearInterval(state.newsAutoScrollTimer);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!el.newsStrip) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.newsAutoScrollTimer = setInterval(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!el.newsStrip) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (el.newsStrip.scrollWidth &lt;= el.newsStrip.clientWidth) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const atEnd = Math.abs(el.newsStrip.scrollWidth - el.newsStrip.clientWidth - el.newsStrip.scrollLeft) &lt; 4;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (atEnd) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>el.newsStrip.scrollTo({ left: 0, behavior: "smooth" });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>el.newsStrip.scrollBy({ left: 240, behavior: "smooth" });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}, 6000);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function fetchNewsFallback() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.news = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>id: "fallback-1",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>title: "Crypto markets consolidate ahead of macro data",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>url: "https://news.example.com/market",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>source: "Fallback",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>summary: "Key majors hold support while traders watch liquidity across L2 ecosystems.",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>publishedAt: Date.now() - 3600000,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>coins: ["BTC","ETH","SOL"]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>id: "fallback-2",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>title: "Layer 2 growth sparks optimism",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>url: "https://news.example.com/l2",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>source: "Fallback",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>summary: "Bridge flows into Base, Blast and Mantle continue to climb with healthy fees.",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>publishedAt: Date.now() - 7200000,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>coins: ["BASE","BLAST","MNT"]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderNews(true);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function fetchNews() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const res = await fetch("https://min-api.cryptocompare.com/data/v2/news/?lang=EN");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!res.ok) throw new Error("News error " + res.status);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const json = await res.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!Array.isArray(json.Data)) throw new Error("Bad news payload");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>state.news = json.Data.slice(0, 25).map(item =&gt; ({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>id: item.id,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>title: item.title,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>url: item.url,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>source: item.source_info?.name || item.source || "CryptoCompare",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>summary: item.body?.slice(0, 140) || "",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>publishedAt: (item.published_on || 0) * 1000,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>coins: (item.tags || "BTC").split("|").map(tag =&gt; tag.trim().toUpperCase()).filter(Boolean)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderNews();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} catch (err) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>console.warn("News fetch failed", err);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>showToast("News feed unavailable", "warn");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>fetchNewsFallback();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- All-in render ---------------------- */</span></p>
<p class="p1"><span class="s1">function renderAll() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const data = state.lastPortfolioData || calculatePortfolio(state.portfolio, state.priceData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.lastPortfolioData = data;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (data.totals.totalValue) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">     </span>ensureChartSeries("30d", data.totals.totalValue);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderSummary(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderHoldings(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderAllocationMini(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderWatchlist();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderChartSection(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderRiskMetrics(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderBenchmarksAndScenario(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderAlerts();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">/* ---------------------- Init ---------------------- */</span></p>
<p class="p1"><span class="s1">function init() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.portfolio = loadPortfolio();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.watchlist = loadWatchlist();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.alerts<span class="Apple-converted-space">    </span>= loadAlerts();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Load persistent FX rates</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const savedFx = loadJson(STORAGE_KEYS.fx, null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (savedFx) state.fxRates = savedFx;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>populateSelects();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const data = calculatePortfolio(state.portfolio,state.priceData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>state.lastPortfolioData=data;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderAll();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>document.querySelectorAll(".timeframe-btn").forEach(btn=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>btn.addEventListener("click", handleTimeframeClick);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>document.querySelectorAll(".chart-type-btn").forEach(btn=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>btn.addEventListener("click", handleChartTypeClick);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.assetForm) el.assetForm.addEventListener("submit", handleAssetForm);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.assetCancelEdit) el.assetCancelEdit.addEventListener("click", clearEditMode);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.assetSearch) el.assetSearch.addEventListener("input", (e) =&gt; populateSelects(e.target.value));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.holdingsBody) el.holdingsBody.addEventListener("click", handleHoldingsClick);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.watchlistForm) el.watchlistForm.addEventListener("submit", handleWatchlistForm);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.watchlistList) el.watchlistList.addEventListener("click", handleWatchlistClick);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.alertsForm) el.alertsForm.addEventListener("submit", handleAlertsForm);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.alertsList) el.alertsList.addEventListener("click", handleAlertsListClick);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.newsCoinFilter) el.newsCoinFilter.addEventListener("change", handleNewsFilter);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.refreshBtn) el.refreshBtn.addEventListener("click", ()=&gt;refreshPrices());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.globalCurrencySelect) el.globalCurrencySelect.addEventListener("change", (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">     </span>state.currency = e.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">     </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.indicatorBB) el.indicatorBB.addEventListener("change", handleIndicatorToggle);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.indicatorRSI) el.indicatorRSI.addEventListener("change", handleIndicatorToggle);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.indicatorMACD) el.indicatorMACD.addEventListener("change", handleIndicatorToggle);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.drawToolSelect) el.drawToolSelect.addEventListener("change", handleDrawToolChange);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.drawClear) el.drawClear.addEventListener("click", handleDrawClear);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.chartCanvas) el.chartCanvas.addEventListener("click", handleChartClick);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.scenarioForm) el.scenarioForm.addEventListener("submit", handleScenarioSubmit);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.riskStressSelect) el.riskStressSelect.addEventListener("change", ()=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const data = state.lastPortfolioData || calculatePortfolio(state.portfolio,state.priceData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>updateStressSummary(data, parseFloat(el.riskStressSelect.value||"-0.25"));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Unlock audio context on user interaction</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>document.addEventListener('click', unlockAudio, { once: true });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>refreshPrices();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fetchNews();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fetchSentiment();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fetchBenchmarks();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">  </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (el.btRunBtn) el.btRunBtn.addEventListener("click", runBacktest);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">document.addEventListener("DOMContentLoaded", init);</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
